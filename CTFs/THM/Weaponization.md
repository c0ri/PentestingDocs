Task 1 - Introduction
-----------------------------------

Here we go over some techniques for weaponization.


### What is Weaponization

This is the 2nd stage in the Cuber Kill Chain model.  This is where the attacker generates malicious code using deliverable payloads like PDF or Word documents, etc. This stage aims to use this weapon to target a machine and gain initial access.

Almost every company uses Windows in some form.  Nowdays most vectors are blocked. Such as just simply sending an .exe file, so we need to be more creative and use obfuscated and custom payloads send in various methods like phishing campaigns, social engineering, exploits, usb or web methods.

The following is an example where a custom PDF or .doc file is used to deliver a malicious payload. Then the payload will connect back to the C2 framework in our Red Team Infrastructure.

![[weaponization-1.png]]

For more information about red team toolkits, please visit the following: a [GitHub repository](https://github.com/infosecn1nja/Red-Teaming-Toolkit#Payload%20Development) that has it all, including initial access, payload development, delivery methods, and others.

Since many common vectors are blocked, we will focus on some LoTL (Living off the Land) technics using internal scripting like:

-   The Windows Script Host (WSH)
-   An HTML Application (HTA)
-   Visual Basic Applications (VBA)
-   PowerShell (PSH)

__Questions__

Let's deploy the target machine in the next task, and we'll get started with the Windows Script Host technique in the subsequent task!
Answer: _None Needed_

Task 2 - Deploy the Windows Machine
---------------------------------------------------------------

Deploy the machine and connect.

```bash
user@machine$ xfreerdp /v:MACHINE_IP /u:thm /p:TryHackM3 +clipboard
```

The username: thm  and the password: TryHackM3

__Questions__
Deploy the attached Windows machine and connect to it via the RDP client. Once this is done, move to the next task.
Answer: _None Needed_

Task 3 - Windows Scripting Host (WSH)
----------------------------------------------------------------

Windows Scripting Host (WSH) is a built-in Windows administration tool that runs batch files to automate and manage tasks within the operating system.

It is a Windows native engine, cscript.exe (for command-line scripts) and wscript.exe (for UI scripts), which are responsible for executing various Microsoft Visual Basic Scripts (VBScript), including vbs and vbe. For more information about VBScript, please visit [here](https://en.wikipedia.org/wiki/VBScript).  Since the engine runs with the same perms as the user it is useful for Red Teamers.

Put the following into a file called `hello.vbs`


```javascript
Dim message 
message = "Welcome to THM"
MsgBox message
```

Then we run it with wscript and get:

![[weaponization-2.png]]

Now let's use this way to run an executable file:

```javascript
Set shell = WScript.CreateObject("Wscript.Shell")
shell.Run("C:\Windows\System32\calc.exe " & WScript.ScriptFullName),0,True
```

Again, we run it with wscript:

```shell-session
c:\Windows\System32>wscript c:\Users\thm\Desktop\payload.vbs
```

or with cscript:


```shell-session
c:\Windows\System32>cscript.exe c:\Users\thm\Desktop\payload.vbs
```

We got the calculator app to open on the desktop:

![[weaponization-3.png]]

Sometimes admins will blacklist .vbs script file extentions from running, but we can also execute them just by renaming them using a .txt extention.

```shell-session
c:\Windows\System32>wscript /e:VBScript c:\Users\thm\Desktop\payload.txt
```

The result is the same, and calc will run.

__Questions__

Try to replace the calc.exe binary to execute cmd.exe within the Windows machine.
Answer: _None Needed_


Task 4 - An HTML Application (HTA)
----------------------------------------------------------

