#redteam 

Task1 - Introduction
-------------------------------

Cybersecurity is a race between white and black hat hackers.

Doing conventional pen testing may show companies where their issues lie, but this isn't the same as what a true motivated black hat might do in a real attack scenario.

### Room objectives

-   Learn about the basics of red team engagements
-   Identify the main components and stakeholders involved in a red team engagement
-   Understand the main differences between red teaming and other types of cybersecurity engagements

### Room prerequisites

Before beginning this room, familiarity with general hacking techniques is required. Although not strictly necessary, completing the Jr. Penetration Tester Learning Path is recommended.

__Questions__

Click to continue to the next task
Answer: _None needed_


Task2 - Vulnerability Assessment and Penetration Tests Limitations
---------------------------------------------

### Vulnerability Assessments

This is one of the simpler forms of security assessment. The company allows you on the network and possibly to be whitelisted on their security products so you can scan and test as many system as possible because they want to know that.

In a typical assessment, you would only be scanning hosts and not really exploiting them.

### Penetration Tests

After scanning another component is to evaluate and understand what an attack might do on systems that were revealed to have weakness. 

* Attempt to exploit the vulnerabilities
* Conduct post-exploitation tasks to see what further issues might be uncovered.

A simple vulnerability might lead to a chain of events like a cascade failure.

Website bug -> reverse-shell -> found credentials -> pivot to another host -> privilege escalation -> etc.

Only by analysing these behaviors can we understand how the attackers might move, and how we can possiblity counter them in a real-life scenario.

### Advanced Persistent Threats and why Regular Pentesting is not Enough

Regular penetration tests are good, but often times they are not enough because of their limitations. Things like:

* Limited Time
* Budget
* Limited Scope
* Attack must be Non-Disruptive
* Heavy IT Focus

While a black hat true "Hacker" might have all the time in the world to methodically work through your systems and network.

Some difference are:

* Pentests are loud, real hackers will try to hide and be quiet and take their time.
* Non-technical attack vectors would be overlooked due to time constraints. Example phishing campaigns.
* Relaxation of Security Measures - Due to time its in the companies best interest to let the Pen testers find as many problem as possible in a short amount of time. They don't have as much time as a real hacker would to find non-conventional means to attack.

Real hackers don't have an ethical code. They can and will do everything. These types of threat actors are known as Advanced Persistent Threats (APT) which are usually a group of highly skilled hackers. such as organised crime groups or well-funded nation states. These types are the most dangerous and can remain hidden in systems for long periods undetected.

If the company was affected by APT, could they respond? How would they know the chain of events that led to this happening? Was it a zero-day? Did someone opening an email run a script and infect the systems?

This is the reason for Red Teams.

__Questions__

Would vulnerability assessments prepare us to **detect** a real attacker on our networks? (Yay/Nay)
Answer: _Nay_

During a penetration test, are you concerned about being detected by the client? (Yay/Nay)
Answer: _Nay_

Highly organised groups of skilled attackers are nowadays referred to as ...
Answer: _Advanced Persistent Threat_


Task3 - Red Team Engagements
--------------------------------------------------

Red Team engagements are designed to test the defensive (Blue) Team's capabilities to detect and defend. They do not replace pentesting engagements but compliment them.

Red Teaming and Blue Teaming is taken from the military where real attack scenarios are acted out to test how responses are done. A threat actor's Tactics, Techniques and Proceedures (TTPs) allow Blue teams to measure their response.

Red Team engagement define clear goals. Once these objects are obtained the Red Team has won the engagement. Red teams don't need to scan or be noisy, but rather define and take a single stealthy route to obtain it.

Blue teams are not notified so there can be no bias in the test.

The true goal isn't really about one team beating the other, but for the Blue team to learn how to detect and react to ever evolving TTPs from the Red Teams.

Red Teams can also improve by:

-   **Technical Infrastructure:** Focus on technical vulns
* **Social Engineering:** Testing the people element (phishing etc.)
* **Physical Intrution:** Breaking into cages, lockpicking, RFID cloning, electronic intrution. 


The Red Team exercise can be run in several ways:

* **Full Engagement** Full on attack
* **Assumed Breach:** Usually start with some credentials
* **Table-Top Exercise:** Theoretical discussions from both side.

__Questions__

The goals of a red team engagement will often be referred to as flags or...
Answer: _Crown Jewels_

During a red team engagement, common methods used by attackers are emulated against the target. Such methods are usually called TTPs. What does TTP stand for?
Answer: _Tactics, Techniques and Proceedures_

The main objective of a red team engagement is to detect as many vulnerabilities in as many hosts as possible (Yay/Nay)
Answer: _Nay_


Task4 - Teams and Functions of an Engagement
--------------------------------------------------

Each engagement can be broken into 3 cells:

* **Red Cell:** Offensive, simulates strategic and tactical responses.
* **Blue Cell:** Defensive, comprises of Blue Team, Defenders, Internal Staff, Management
* **White Cell:** Referee between Red and Blue cell responses, controls network/environment. Monitors adherence to the Rules of Engagement, ensures objectives are met, ensures no bias.

More here from [redteam.guide](https://redteam.guide/docs/definitions).

A typical Red Cell consists of:

* **Red Team Lead:** Plans, organise at high level, delegates.
* **Red Team Assistant Lead:** Assists lead in organising engagements, oversee operations and operators, documentation.
* **Red Team Operator:** Executes assignments from leads. Interpret and Anaylse plans from leads.

Of course other teams' cells will have their own but we are focussed on Red here.

__Questions__

What cell is responsible for the offensive operations of an engagement?
Answer: _Red Cell_

What cell is the trusted agent considered part of?
Answer: _White Cell_


Task5 - Engagement Structure
----------------------------------------------

The core function of the Red Team is adversary emulation. Not mandatory but tries to simulate real life. Red Team uses various Cyber Kill Chains to summarize and access the steps of engagement.

The Blue team uses Cyber Kill Chains to map behaviors and break down adversary movement. The Red Team can use this and adapt their TTPs.

Many companies have a Cyber Kill Chain. Here is a short list:

-   [Lockheed Martin Cyber Kill Chain](https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html)
-   [Unified Kill Chain](https://unifiedkillchain.com/)
-   [Varonis Cyber Kill Chain](https://www.varonis.com/blog/cyber-kill-chain/)
-   [Active Directory Attack Cycle](https://github.com/infosecn1nja/AD-Attack-Defense)
-   [MITRE ATT&CK Framework](https://attack.mitre.org/)

Lockheed Martin has a more standarized kill chain.

LM kill chain focuses on perimeter and external breaches. It doesn't focus on internal movement.

Here are the components:

* **Reconnaissance:** Obtain info on target eg. Harvest mails, OSINT
* **Weaponization:** Combine objective with an exploit, resulting in deliverable payload. eg. Backdoor, malicious script/doc
* **Delivery:** How to delivery the payload to the target. eg. Email, Web, USB
* **Exploitation:** Exploit targets to execute code. eg. MS17-010, Zero-Logon, etc.
* **Installation:** Install malware/tools. eg. Mimikatz, Rubeus, etc.
* **Command & Control:** Control compromised asset from remote controller. eg. Empire, Cobalt Strike, etc.
* **Actions on Objectives:** Obtain any end objectives: ransom, data, etc. eg. Conti, LockBit2.0, etc.

__Questions__

If an adversary deployed Mimikatz on a target machine, where would they be placed in the Lockheed Martin cyber kill chain?
Answer: _Installation_

What technique's purpose is to exploit the target's system to execute code?
Answer: _Exploitation_

Task6 - Overview of a Red Team Engagement
------------------------------------------------

In this task we will view a short demo about how a Red Team Engagement works:

* Planning - Red/White teams discuss (no blue team)
* Intel Gathering - Pull together as much info as possible like Technologies used, employee list, social media info, photos etc.Some malware also used by groups such as [Carbanak](https://attack.mitre.org/groups/G0008/) can also collect info for further osint.
* Emulating TTP: Phishing campaign - Blue team detects phishing and sends out warnings but the attack continues since there is no process to check for infections, delete malicious emails or stop it. Attackers found email pattern based on employee data collected on LinkedIn (first.last@bank.example.com) 
* Emulating TTP: PrivEsc and Persistance - Red team finds BOB-PC has missing patches and exploits it via the [PrintNightmare](https://0xdf.gitlab.io/2021/07/08/playing-with-printnightmare.html) exploitation. The red team then uploads/uses a modified mimikatz to dump hashes including local admin account "Backups"
* Emulating TTP: Lateral Movement - Red team tried pass-the-hash on all hosts which they found were blocked by firewall however they found a workstation DBA-PC, which they used the pass-the-hash on, and from there they could use that as a pivot to the Database server. While there were many alerts, Blue team ignored because they thought it was part of the monthly backup process.
* Reporting and Analysis: Discussion on how to improve security. Note that though this was successful, even failed attempt can uncover ways to improve.

__Questions__

Click the "View Site" button and follow the example engagement to get the flag
Answer: _THM{RED_TEAM_ROCKS}_


Task7 - Conclusion
---------------------------------

This showed a simplied view of a Red Team Engagement. We learned:

* Intel Gathering (OSINT) is very important. Also timing can be critical. Eg. If you know backup schedule occurs on a Sunday, can you perform your attack during that time to cover tracks?
* Evading Security
* Perform Lateral Movement
* Avoid Detection at all costs.

__Questions__

Read the above and continue learning!
Answer: _None Needed_





