Learn how to use DNS, advanced searching, Recon-ng, and Maltego to collect information about your target.

Task 1 - Introduction
-----------------------------------

It is important to understand your enemy in battle. If you watch and wait, you can understand their normal patterns and attack during a time they are not expecting.

Reconnaisance (recon) allows us to collect various information about our target without alerting them to our precense because it is a passive activity where we don't really need to connect to any of their resources. Much information can be found on the internet.

The tasks of this room cover the following topics:

-   Types of reconnaissance activities
-   WHOIS and DNS-based reconnaissance
-   Advanced searching
-   Searching by image
-   Google Hacking
-   Specialized search engines
-   Recon-ng
-   Maltego

Some specific objectives we'll cover include:

-   Discovering subdomains related to our target company
-   Gathering publicly available information about a host and IP addresses
-   Finding email addresses related to the target
-   Discovering login credentials and leaked passwords
-   Locating leaked documents and spreadsheets

There are essentially 2 types of recon:

* Active - This is noisy and may alert somenoe to our precense.
* Passive - This is stealthy and won't require us to connect to the enemy but rather gather data from other sources outside of the enemy resources.

__Questions__

We suggest you start the AttackBox and experiment with every command and tool we demonstrate.
Answer: _None Needed_

Task 2 - Taxonomy of Reconnaissance
----------------------------------------------------------------

Reconnaissance (recon) can be classified into two parts:

1.  **Passive Recon**: can be carried out by watching passively
2.  **Active Recon**: requires interacting with the target to provoke it in order to observe its response.

Passive recon is just using open tools like DNS lookups, whois and other data that are maintained by 3rd parties. We can find lots of great info such as IP address blocks, email addresses, employee names, and job postings.

Active recon requires that we interact with the target by sending requests and packets and observing the responses. An example is using NMAP to scan a target. In this type, we want to discover things like hosts, running servers, listening services and version numbers.

Active recon can be classified as:

1.  **External Recon**: Conducted outside the target's network and focuses on the externally facing assets assessable from the Internet. One example is running Nikto from outside the company network.
2.  **Internal Recon**: Conducted from within the target company's network. In other words, the pentester or red teamer might be physically located inside the company building. In this scenario, they might be using an exploited host on the target's network. An example would be using Nessus to scan the internal network using one of the target’s computers.

__Questions__

Ensure you have a clear understanding of the different types of recon activities before proceeding.
Answer: _None Needed_


Task 3 - Built-In Tools
------------------------------------

In this task we will learn about some of the passive recon tools:

* whois
* dig
* nslookup
* host
* tracert / traceroute

	WHOIS, is a request/response protocol which is used to query Registrar Database of domain names which they are required to keep as part of the RFC 3912 spec. The whois command will query that database and return information we are looking for.

We can see things like:

-   Registrar WHOIS server
-   Registrar URL
-   Record creation date
-   Record update date
-   Registrant contact info and address (unless withheld for privacy)
-   Admin contact info and address (unless withheld for privacy)
-   Tech contact info and address (unless withheld for privacy)


```bash
pentester@TryHackMe$ whois thmredteam.com
[Querying whois.verisign-grs.com]
[Redirected to whois.namecheap.com]
[Querying whois.namecheap.com]
[whois.namecheap.com]
Domain name: thmredteam.com
Registry Domain ID: 2643258257_DOMAIN_COM-VRSN
Registrar WHOIS Server: whois.namecheap.com
Registrar URL: http://www.namecheap.com
Updated Date: 0001-01-01T00:00:00.00Z
Creation Date: 2021-09-24T14:04:16.00Z
Registrar Registration Expiration Date: 2022-09-24T14:04:16.00Z
Registrar: NAMECHEAP INC
Registrar IANA ID: 1068
Registrar Abuse Contact Email: abuse@namecheap.com
Registrar Abuse Contact Phone: +1.6613102107
Reseller: NAMECHEAP INC
Domain Status: clientTransferProhibited https://icann.org/epp#clientTransferProhibited
Registry Registrant ID: 
Registrant Name: Withheld for Privacy Purposes
Registrant Organisation: Privacy service provided by Withheld for Privacy ehf
Registrant Street: Kalkofnsvegur 2 
Registrant City: Reykjavik
Registrant State/Province: Capital Region
Registrant Postal Code: 101
Registrant Country: IS
Registrant Phone: +354.4212434
Registrant Phone Ext: 
Registrant Fax: 
Registrant Fax Ext: 
Registrant Email: 4c9d5617f14e4088a4396b2f25430925.protect@withheldforprivacy.com
Registry Admin ID: 
Admin Name: Withheld for Privacy Purposes
[...]
Tech Name: Withheld for Privacy Purposes
[...]
Name Server: kip.ns.cloudflare.comName Server: uma.ns.cloudflare.com
DNSSEC: unsigned
URL of the ICANN WHOIS Data Problem Reporting System: http://wdprs.internic.net/
>>> Last update of WHOIS database: 2021-10-13T10:42:40.11Z <<<
For more information on Whois status codes, please visit https://icann.org/epp
```

At first glance it looks basic, but having details about the owner, technical admin, email addresses, name servers etc is very valuable.

Next is DNS. We can use tools like nslookup and dig to return information.

```bash
pentester@TryHackMe$ nslookup cafe.thmredteam.com
Server:		127.0.0.53
Address:	127.0.0.53#53

Non-authoritative answer:
Name:	cafe.thmredteam.com
Address: 104.21.93.169
Name:	cafe.thmredteam.com
Address: 172.67.212.249
Name:	cafe.thmredteam.com
Address: 2606:4700:3034::ac43:d4f9
Name:	cafe.thmredteam.com
Address: 2606:4700:3034::6815:5da9
```


Dig is a tool that gives us more fine-grained control to find information. We can do things like point it at whatever DNS server we want. Here we will use Cloudflares DNS and ask our question:

```bash
pentester@TryHackMe$ dig cafe.thmredteam.com @1.1.1.1

; <<>> DiG 9.16.21-RH <<>> cafe.thmredteam.com @1.1.1.1
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 16698
;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;cafe.thmredteam.com.		IN	A

;; ANSWER SECTION:
cafe.thmredteam.com.	3114	IN	A	104.21.93.169
cafe.thmredteam.com.	3114	IN	A	172.67.212.249

;; Query time: 4 msec
;; SERVER: 1.1.1.1#53(1.1.1.1)
;; WHEN: Thu Oct 14 10:44:11 EEST 2021
;; MSG SIZE  rcvd: 80
```

Another tool is the host tool. This tool will use local information from /etc/hosts before other sources where configured so be aware of that. These can be configured in /etc/nsswitch.conf along with the order of search on linux/unix systems.

```bash
pentester@TryHackMe$ host cafe.thmredteam.com
cafe.thmredteam.com has address 172.67.212.249
cafe.thmredteam.com has address 104.21.93.169
cafe.thmredteam.com has IPv6 address 2606:4700:3034::ac43:d4f9
cafe.thmredteam.com has IPv6 address 2606:4700:3034::6815:5da9
```

The last tool we will talk about is traceroute (linux systems) and tracert (windows systems).  These tools do the same thing, just written for different OS's.  As the name implies, it will trace the route of a packet from one location to another letting you examine the 'hops' between source and target. Please be aware that some routers won't respond to ping as a result we won't see their IP addresses. In that case we just see stars.

```bash
pentester@TryHackMe$ traceroute cafe.thmredteam.com
traceroute to cafe.thmredteam.com (172.67.212.249), 30 hops max, 60 byte packets
 1  _gateway (192.168.0.1)  3.535 ms  3.450 ms  3.398 ms
 2  * * *
 3  * * *
 4  * * *
 5  * * *
 6  * * *
 7  172.16.79.229 (172.16.79.229)  4.663 ms  6.417 ms  6.347 ms
 8  * * *
 9  172.16.49.1 (172.16.49.1)  6.688 ms 172.16.48.1 (172.16.48.1)  6.671 ms 172.16.49.1 (172.16.49.1)  6.651 ms
10  213.242.116.233 (213.242.116.233)  96.769 ms 81.52.187.243 (81.52.187.243)  96.634 ms  96.614 ms
11  bundle-ether302.pastr4.paris.opentransit.net (193.251.131.116)  96.592 ms  96.689 ms  96.671 ms
12  193.251.133.251 (193.251.133.251)  96.679 ms  96.660 ms  72.465 ms
13  193.251.150.10 (193.251.150.10)  72.392 ms 172.67.212.249 (172.67.212.249)  91.378 ms  91.306 ms
```

In summary, these are passive tools. The safest of these is nslookup, dig since they query publically available info from public services. Traceroute is also quite safe to use as there is nothing illegal about using them, however, they can show up in logs if configured, tho it would appear innocuous.

__Questions__

When was `thmredteam.com` created (registered)? (YYYY-MM-DD)
Answer: _2021-09-24_

To how many IPv4 addresses does `clinic.thmredteam.com` resolve?
Answer: _2_

  
To how many IPv6 addresses does `clinic.thmredteam.com` resolve?
Answer: _2_


Task 4 - Advanced Searching
---------------------------------------------------

