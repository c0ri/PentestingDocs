Task1 - Introduction
-----------------------------------------

This rooms' focus will be around Active Directory.

Task2 - Windows Domains
------------------------------------------

The main purpose of a Windows Domain is to simplify the management of a large number of devices and users by managing policy through a single source of truth which is called Active Directory (AD).

Advantages:
Central Identity Management
Managing Security Policies

In this task we will take over role of Admin on THM.local.

__Questions__
In a Windows domain, credentials are stored in a centralised repository called...
Answer:_active directory_

The server in charge of running the Active Directory services is called...
Answer: _domain controller_


Task3 - Active Directory
-----------------------------------------------

The Core of AD is Domain Service (DS). It is a catalog of objects such as user, group, machines etc.

Principals are objects such as users which can act within the domain because they can be authenticated by the domain and assigned priviledges over resources like machines and printers.

There are 2 types of Users:
1. People - those who are normal people doing their jobs.
2. Service Users - Services need to run as a user, but these users are generally only require certain privs to run a specfic service/task.

Machines are another object in the domain but also considered a Security Principal and get assigned accounts like any other user. They have local administrator on the assigned computer with limited rights in the domain.

Machine account passwords are generally rotated and are comprised of 120 random characters.

Machine accounts are easy to identify because they follow some kind of naming scheme DC01$ and as you see are followed with a dollar sign.

Here are some typical security groups:
**Security Group**

**Description**

Domain Admins

Users of this group have administrative privileges over the entire domain. By default, they can administer any computer on the domain, including the DCs.

Server Operators

Users in this group can administer Domain Controllers. They cannot change any administrative group memberships.

Backup Operators

Users in this group are allowed to access any file, ignoring their permissions. They are used to perform backups of data on computers.

Account Operators

Users in this group can create or modify other accounts in the domain.

Domain Users

Includes all existing user accounts in the domain.

Domain Computers

Includes all existing computers in the domain.

Domain Controllers

Includes all existing DCs on the domain.

Microsoft has an exhaustive list here:
https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/active-directory-security-groups

You can open Active Directory Users and Computers from start menu search for users.

It will display a list of objects organised by Organizational Units (OU). 

Note: A User can only be part of a single OU at a time.

An OU can be defined arbitrarily but generally has some normal naming schemes for companies.

Default Containers other than our your own:

-   **Builtin:** Contains default groups available to any Windows host.
-   **Computers:** Any machine joining the network will be put here by default. You can move them if needed.
-   **Domain Controllers:** Default OU that contains the DCs in your network.
-   **Users:** Default users and groups that apply to a domain-wide context.
-   **Managed Service Accounts:** Holds accounts used by services in your Windows domain.

Security Groups vs. OU

OU is used to apply policy to users and computers that have sets of policies for set configurations.
SGs are used to grant permissions over resources such as printers.

__Questions__

Which group normally administrates all computers and resources in a domain?
Answer: _domain admins_

What would be the name of the machine account associated with a machine named TOM-PC?
Answer: _TOM-PC$_

Suppose our company creates a new department for Quality Assurance. What type of containers should we use to group all Quality Assurance users so that policies can be applied consistently to them?
Answer: _organizational units_


Task4 - Managing Users in AD
-----------------------------------------------

For this task we have to make a new OU for THM.

This means deleting the Research group containing the user Bob. You can right click on the group, go to advanced, and uncheck the property to prevent accidental deletion.

Then we use delegation to allow the user Phillip to manage all users password resets. This is accomplished by right clicking a group in the OU and Delegation. Then add user phillip, check name, then next, then check the box for password, next, finish. Do for each group.

Next login as Phillip on RDP.

```bash
/u:THM\phillip /p:Claire2008 /cert:ignore /v:10.10.8.80 /smart-sizing:1600x1200
```

As Phillip we need to open a Powershell and reset user Sophie's password.

```shell-session
PS C:\Users\phillip> Set-ADAccountPassword sophie -Reset -NewPassword (Read-Host -AsSecureString -Prompt 'New Password') -Verbose

New Password: *********

VERBOSE: Performing the operation "Set-ADAccountPassword" on target "CN=Sophie,OU=Sales,OU=THM,DC=thm,DC=local".
```

We can also force Sophie to reset her password again upon next login with this command:

```shell-session
PS C:\Users\phillip> Set-ADUser -ChangePasswordAtLogon $true -Identity sophie -Verbose

VERBOSE: Performing the operation "Set" on target "CN=Sophie,OU=Sales,OU=THM,DC=thm,DC=local".
```

Next we login with user Sophie on RDP.

```bash
/u:THM\sophie /p:N3wpa44wurD% /cert:ignore /v:10.10.8.80 /smart-sizing:1600x1200
```

__Questions__

What is the flag found on Sophie's desktop?
Answer: _THM{thanks_for_contacting_support}

The process for granting privileges to a user over some OU or other AD object is called..
Answer: _delegation_

Task5 - Managing Computers in AD

In this task we just need to create 2 OUs under thm.local
Workstations
Servers

Then in the original Computers OU, we can select all computers except the 3 servers, and click move to move those to the new Workstations group, and for the remaining 3 servers, move those to Servers Group.

__Questions__
After organising the available comptuers, how many ended up in the Workstations OU?
Answer: _7_

Is it recommended to create separate OUs for Servers and Workstations? (yay/nay)
Answer: _yay_


Task6 - Group Policies
---------------------------------

The main idea here is to use Group Policy Objects (GPOs) to push separate policies for each group.

To configure GPOs you can use Start->Group Policy Management

You can edit policies by right clicking the policy then click Edit and then navigate to the policy you want to change.
Eg. Right click on 'Default Domain Policy' then click Edit. Then under Computer Configurations->Policies->Windows Settings->Security Settings->Account Policies->Password Policy you can change password related settings, click Apply.

In this task we will create some GPOs.

1st, we want to restrict access to the control panel to only IT users.

