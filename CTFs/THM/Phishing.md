Task 1 - Brief
---------------------

This room will discuss phishing, how it is done and some valuable tools. This is an essential part of any Red Team enagement.

__Questions__

I am ready to learn!
Answer: _None Needed_


Task 2 - Intro To Phishing Attacks
----------------------------------------------------

Phishing is a form of Social Engineering, whereby some type of psychological  manipulation is performed on a person or group to exploit some weakness in their human nature  and get them to act in a way we desire. These "weaknesses" can be curiosity, jealously, greed and even kindness and the willingness to help someone. Phishing is a source of social engineering delivered through email to trick someone into either revealing personal information, credentials or even executing malicious code on their computer.

These emails _appear_ to come from trusted sources and entice the user to click on a link or open an attachment in order to run some software on their computer unwittingly. 

One of the more popular forms of this recently is _spear-phishing_, and as you can imagine it is like aiming a spear at a target and throwing it. It is a much more targeted form of phishing. This type of attack is more direct and usually has some details about the user that it is intended for, so it is much less likely to be caught by spam filters, anitvirus and firewalls.

A Red Team assignment maybe solely to carry out a Phishing campaign to determine how vulnerable a business is to this type of attack, and/or train employees on what to look for and what to do in case of a real phishing attack.

Another form of phishing through SMS is called Smishing. 

**Example Scenario:**

The below example shows how an employee could be tricked into revealing their credentials.

1. Attacker locates the physical location of the target business.
2. Attacker then looks for nearby food suppliers and discovers a company called Ultimate Cookies!
3. The Attacker registers the domain name ultimate-cookies.thm
4. The Attacker then crafts and email to their target, tempting then with an offer of receiving some free cookies if they sign up for the website.  Because the victim has heard of this company, they are more likely to trust it.
5. The Victim then follows the link in the email to the fake website created by the attacker and registers online. To keep things simple, the victim reuses the same password for all their online accounts.
6. The Attacker now has the victim's email address and password and can log onto the victim's company email account. The attacker could now have access to the private company information and also have somewhere to launch another phishing attack against other employees.

__Questions__

What type of psychological manipulation is phishing part of?
Answer: _Social Engineering_

What type of phishing campaign do red teams get involved in?
Answer: _spear-phishing_


Task 3 - Writing Convincing Phishing Emails
----------------------------------------------------------------------

We basically have 3 things to work with. Sender's Email Address, Subject and Content.

### The Sender's Address:
Ideally, we want our Sender's email to look legitimate, so spoofing a popular site/brand, a known contact or coworker is best.

To find out what types of people that a victim interacts with, you can use some OSINT techniques to do some digging. For Example:

-   Observe their social media account for any brands or friends they talk to.
-   Searching Google for the victim's name and rough location for any reviews the victim may have left about local businesses or brands.
-   Looking at the victim's business website to find suppliers.
-   Looking at LinkedIn to find coworkers of the victim.

### The Subject:
The subject should be something that piques the victim's interests, so they can't ignore it and something they should act on quickly.

Examples:
1.  Your account has been compromised.
2.  Your package has been dispatched/shipped.
3.  Staff payroll information (do not forward!)
4.  Your photos have been published.

### The Content:
If impersonating a brand or supplier, it would be pertinent to research their standard email templates and branding (style, logo's images, signoffs etc.) and make your content look the same as theirs, so the victim doesn't expect anything.

When impersonating people it is very helpful to contact them first, to see what mannerisms they use and see if they have a certain email template or signature that we can copy to make the mail seem legit.  

Remember that all of the finishing details we can add, increase the chances of our psychological operation working.

If we use a spoof website, the links should be disgused as much as possible. You should use anchor text and change the title. Some examples are:

`<a href="http://spoofsite.thm">Click Here</a>`

`<a href="http://spoofsite.thm">https://onlinebank.thm</a>`


__Questions__

What tactic can be used to find brands or people a victim interacts with?
Answer: _OSINT_

What should be changed on an HTML anchor tag to disguise a link?
Answer: _anchor text_


Task 4 - Phishing Infrastructure
----------------------------------------------------

A certain amount of infrastructure will need to be put in place to launch a successful phishing campaign.

  

**Domain Name:**

You'll need to register either an authentic-looking domain name or one that mimics the identity of another domain. See task 5 for details on how to create the perfect domain name.

  

**SSL/TLS Certificates:**

Creating SSL/TLS certificates for your chosen domain name will add an extra layer of authenticity to the attack.

  

**Email Server/Account:**

You'll need to either set up an email server or register with an SMTP email provider. 

  

**DNS Records:**

Setting up DNS Records such as SPF, DKIM, DMARC will improve the deliverability of your emails and make sure they're getting into the inbox rather than the spam folder.

  

**Web Server:**

You'll need to set up webservers or purchase web hosting from a company to host your phishing websites. Adding SSL/TLS to the websites will give them an extra layer of authenticity. 

  

**Analytics:**

When a phishing campaign is part of a red team engagement, keeping analytics information is more important. You'll need something to keep track of the emails that have been sent, opened or clicked. You'll also need to combine it with information from your phishing websites for which users have supplied personal information or downloaded software. 

**Automation And Useful Software:**

Some of the above infrastructures can be quickly automated by using the below tools.

  

**GoPhish - (Open-Source Phishing Framework) - [getgophish.com](https://getgophish.com/)  
**

GoPhish is a web-based framework to make setting up phishing campaigns more straightforward. GoPhish allows you to store your SMTP server settings for sending emails, has a web-based tool for creating email templates using a simple WYSIWYG (What You See Is What You Get) editor. You can also schedule when emails are sent and have an analytics dashboard that shows how many emails have been sent, opened or clicked.

  

The Next task will talk you through how to launch a phishing campaign using this software.  

  

**SET - (Social Engineering Toolkit) - [trustedsec.com](https://www.trustedsec.com/tools/the-social-engineer-toolkit-set/)  
**

The Social Engineering Toolkit contains a multitude of tools, but some of the important ones for phishing are the ability to create spear-phishing attacks and deploy fake versions of common websites to trick victims into entering their credentials.

![[phishing-1.png]]

__Questions__

What part of a red team infrastructure can make a website look more authentic?
Answer: _SSL/TLS Certificates_

What protocol has TXT records that can improve email deliverability?
Answer: _DNS_

What tool can automate a phishing campaign and include analytics?
Answer: _GoPhish_


Task 5 - Using GoPhish
-------------------------------------

In this task we will setup GoPhish and learn about setting up a phishing campaign and capturing credentials from a spoof website.

Start machine.

![[gophish-1.png]]

If you see an error related to nginx, wait 30 seconds and try again.
usename: admin password: tryhackme

### Sending Profiles:

Sending Profiles are just a collection of your SMTP server details. Before sending our emails we need to configure at least one SMTP server.

Click the Sending Profiles link on the left-hand menu and then click the  "New Profile" button.

Next, add in the following information as per the screenshot below:

Name: **Local Server**

From: **noreply@redteam.thm**

Host: **127.0.0.1:25**

![[gophish-2.png]]

Then click "Save Profile"

### Landing Pages:

Next, we are going to setup the landing page. This is the webpage that users land on when they first click the link in the email. This page should look legitimate, so this page is usually a spoof of a website that a user is familiar with.                                                                                                                                    

Click the Landing Pages link on the left-hand menu, then click the "New Page" button.

Give the Landing Page the name **ACME Login**, next in the HTML box; you'll need to press the **Source** button to allow us to enter the HTML code as shown below:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ACME IT SUPPORT - Admin Panel</title>
    <style>
        body { font-family: "Ubuntu", monospace; text-align: center }
        div.login-form { margin:auto; width:300px; border:1px solid #ececec; padding:10px;text-align: left;font-size:13px;}
        div.login-form div input { margin-bottom:7px;}
        div.login-form input { width:280px;}
        div.login-form div:last-child { text-align: center; }
        div.login-form div:last-child input { width:100px;}
    </style>
</head>
<body>
    <h2>ACME IT SUPPORT</h2>
    <h3>Admin Panel</h3>
    <form method="post">
        <div class="login-form">
            <div>Username:</div>
            <div><input name="username"></div>
            <div>Password:</div>
            <div><input type="password" name="password"></div>
            <div><input type="submit" value="Login"></div>
        </div>
    </form>
</body>
</html>
```

Click the **Source** button again, and you should see a login box with username and password fields as per the image below, also click the **Capture Submitted Data** box and then also the **Capture Passwords** box and then click the Save Page button.

![[gophish-3.png]]

### Email Templates:

This is the design of the email that you will send to the victim(s). It also will need to look legitimate so we can entice the user to click.

Click "Email Templates" link on the left-hand side, then click the "New Template" button. Give a name and Subject, click the HTML Tab, and then Source as before so we can enable the HTML editor mode. In the contents put something persuasive in the email that will get the user to click the link. 

The link text will need to be set to http://admin.acmeitsupport.thm, but the actual link (URL) will need to be set to {{.URL}} as this will get changed to our actual spoofed landing page when the email is sent. You can do this by clicking the link button on top row of icons and make sure to set the protocol dropdown to **other**.

![[gophish-4.png]]
![[gophish-5.png]]

Your email should look similar. Click "Save Template" when you are done.

![[gophish-6.png]]


### Users & Groups

This is where we can store the email addresses of our targets.

Click the Users & Groups link on the left-hand side, then "New Group". Give the group the name "Targets" and then add the following email addresses:

martin@acmeitsupport.thm  
brian@acmeitsupport.thm  
accounts@acmeitsupport.thm

Next, click "Save Template".  Afterwards, it shoud look like this:

![[gophish-7.png]]

### Campaigns

Now we are ready to send out our 1st campaign. Click on the "Campaigns" button on the left-hand menu and then click on the "New Campaign" button.   Set the following values:

Name: Campaign One

Email Template: Email 1

Landing Page: ACME Login

URL: http://10.10.78.87

Launch Date: For this lab set it to 2 days ago just to make sure there is no complication with different timezones, in a real operation this would be set correctly.  

Sending Profile: Local Server

Groups: Targets

Once complete, click "Launch Campaign". You should see an "Are You Sure" prompt where you can just press the "Launch" button to begin.

Next you will be directed to the results page of the campaign.

### Results

The results pages gives us an idea how the campaign is going. It shows us details like how many emails were sent, and if they have been delivered, opened, clicked and how many users have submitted data to our spoof site.

You will see a breakdown for each user like this:

![[gophish-8.png]]

We can get more information on them by clicking the arrow to the left-hand side of the user. In the example above if we click the arror next to accounts user, where there is an error, then we can get more details about why the email failed:

![[gophish-9.png]]

After a few mins we should see one of the emails have changed to "Submitted Data".

![[gophish-10.png]]

__Questions__

What is the password for Brian?
Answer: _`p4$$w0rd!`_


Task 6 - Droppers
----------------------------------

Droppers are software that phishing victims are tricked into downloading and running on their system such as a codec to view a type of video or open a kind of file.

Typically, the droppers themselves are not malware and they can pass virus checks. Once installed they will download the malware later in the background to be installed on the victim's computer.  The malware then can connect back to the attackers C2 infra so that the victim's PC can be controlled.

__Questions__

Do droppers tend to be malicious?
Answer: _Nay_

Task 7 - Choosing A Phishing Domain
------------------------------------------------------------

Choosing a good phishing domain is essential because the more real we can make it seem the bigger the psychological edge over the target.  Here are some methods:

### Expired Domains:
Getting a domain that has expired, will have some history associated with it and can lead to better scoring of your domain when it comes to spam filters.

### Typosquatting:
This is when you make a domain look very similar to a target. Typically people mistype words a lot. So if they mistype "google.com" for example, and you have registred and are squatting on the domain "gogle.com", then the victim will land on your page where you can control what scripts to send them.

Here are some other examples:

**Misspelling:** goggle.com Vs google.com

**Additional Period:** go.ogle.com Vs google.com

**Switching numbers for letters:** g00gle.com Vs google.com

**Phrasing:** googles.com Vs google.com

**Additional Word:** googleresults.com Vs google.com

When focussing on these, it may seem unrealistic to think that someone might click on one of these, but in reality, the human brain is a pattern matching machine. On a quick glance it may fill in the blanks and see what it wants. i.e. - The Correct Domain.

### TLD Alternatives:
Another common trick is to use a Top Level Domain (TLD) which is different. Nowdays there are hundreds on new TLDs. For example, register tryhackme.co.uk to impersonate tryhackme.com

### IDN Homograph Attack/Script Spoofing:
Originally domain names were made up of Latin characters a-z and 0-9, but in 1998, IDN (internationalized domain name) was implemented to support language-specific script or alphabet from other languages such as Arabic, Chinese, Cyrillic, Hebrew and more. An issue that arises from the IDN implementation is that different letters from different languages can actually appear identical. For example, Unicode character U+0430 (Cyrillic small letter a) looks identical to Unicode character U+0061 (Latin small letter a) used in English, enabling attackers to register a domain name that looks almost identical to another.

![[idn-homograph-1.png]]

__Questions__

What is better, using an expired or new domain? (old/new)
Answer: _old_

What is the term used to describe registering a similar domain name with a spelling error?
Answer: _Typosquatting_

