Task 1 - Introduction
---------------------------------

OPSEC - “Systematic and proven process by which potential adversaries can be denied information about capabilities and intentions by identifying, controlling, and protecting generally unclassified evidence of the planning and execution of sensitive activities. The process involves five steps: identification of critical information, analysis of threats, analysis of vulnerabilities, assessment of risks, and application of appropriate countermeasures.” 

-NIST

It is critical to deny our adversary the ability to gather info about our capabilities and intentions. This is critical for OPSEC.  OPSEC is indentifying, controlling and protecting that information. 

As we have seen, there a Cyber Kill Chain's like Lockheed Martin's Cyber Kill Chain and MITRE ATT_&CK which help defenders identify the objectives of an adversary and what they want to accomplish


The OPSEC process has five steps:

1.  Identify critical information
2.  Analyse threats
3.  Analyse vulnerabilities
4.  Assess risks
5.  Apply appropriate countermeasures. 

If a defender finds out that you are scanning their network with nmap, they could easily find the IP address you are using to scan it with. If you used the same address to host a phishing site, then it won't be hard to connect the dots and attribute them to the same actor.

OPSEC is not a solution in itself, but is a 5 step proces to help defend critical information from the advarsary. In this room we will check out each step and see how we can improve OPSEC as part of our Red Team Operations.

__Questions__

Aim to memorize the five steps of the OPSEC process as we explain each one in its own task.
Answer: _None Needed_

Task 2 - Critical Information Identification
-----------------------------------------------------------------

Critical Info may change upon the Red Team's misssion or directives, but it would be anything that would hinder or degrade their mission.

Some Examples:
* Client Information. It's unacceptible to share PII such as employee names, roles, etc. This information must be only divuldged using the principle of least privilege (PoLP)
* Red Team Information such as plans, identities, capabiltities and limitations. If the Blue teams knew this, they could defend against us better.
* Tactics, Techniques, and Proceedures (TTP) your team uses to emulate an attack.
* OS, Cloud hosting provider, or C2 framework your team users. Again if the Blue teams know this they can pre-block all that or be watching for it at all times.
* Public IP addresses your team uses.
* Domain names that your team has registered. These also play a big role in phishing campaigns. 
* Hosted Websites

__Questions__

  
Click on View Site and follow through till you get the flag.

(Please note that some browser extensions, such as NoScript, might prevent the site from loading correctly.)
Answer: _THM{OPSEC_CRITICAL_INFO}_

Task 3 - Threat Analysis
-------------------------------------------

The next step is Analysing Threats. This process refers to identifying potential adversaries and their intentions and capabilities.

US Department of Defense [(DoD) Operations Security (OPSEC) Program Manual](https://www.esd.whs.mil/Portals/54/Documents/DD/issuances/dodm/520502m.pdf), we aun ti answer the following:

1. Who - is the adversary
2. What - are their goals
3. What - are their tactics/techniques
4. What - critical info have they obtained

The Red Team's job is to emulate an attack, while the Blue Team's job is to defend so that they can learn lessons and correct before a real adversary strikes. Though the Blue Team's objectives are clear, their initial capabilities may not be known.

Malicious 3rd party players might have different capabilities and intentions and might pause a threat as a result. They may appear harmless or just scanning for low hanging fruit like an unpatched server, but they may be a very capable adversary.

| Adversary           | Intentions         | Capabilities     |
| ------------------- | ------------------ | ---------------- |
| Blue Team           | Keep intruders out | Not always known |
| Malicious 3rd Party | Varies             | Varies           |

As Red Team we must consider any adversary with the intent and capability to be a possible threat to our mission.
```threat = adversary + intent + capability```

An adversary without intent or capability does not pose a threat for our purposes.

__Questions__
  
Try to think of at least one adversary who is not a threat and one who is a threat.
Answer: _None Needed_


Task 4 - Vulnerability Analysis
------------------------------------------------

After analysing the threats, we can start the 3rd step which is to anaylse the vulnerabilities. This is not the same as Cybersecurity vulnerabilities, but rather an OPSEC vulnerability which is when an adversary finds critical information, analyses it and acts on it in such a way as to disrupt our plans.

Example 1:

If you use the same IP to run ops such as phishing, metasploit, nmap scans etc, this can lead to OPSEC vulnerability since if the blue team finds one of them and bans the IP, then everything else would fail.

Example 2:

Your Red Team uses a phishing campaign to collect PII, and then you store it in an un-encrypted datase. Then a malicious 3rd party finds it and uses it to hack into the customer ahead of you. Now instead of running your war game scenarios, you are helping the customer or Blue team expose the login names and passwords.

Other types of information your team may inadvertantly leak on Social Media may tip off a Blue team to investigate how you operate and put up a better defense.

__Questions__

Your red team uses THC-Hydra to find the password for a specific login page. Moreover, they are using the Metasploit framework on the same system as THC-Hydra. Would you consider this an OPSEC vulnerability? (Y/N)
Answer: _Y_

One of the red team members posts a photo of his cat every day. Would this be considered an OPSEC vulnerability? (Y/N)
Answer: _N_

Your red team went for dinner, took a photo, and tagged every team member on a popular social media platform. Would you consider this an OPSEC vulnerability? (Y/N)
Answer: _Y_

Your red team posts on its website a list of clients you regularly conduct red team exercises with. Would you consider this an OPSEC vulnerability? (Y/N)
Answer: _Y_

One of your red team members posted a photo of her morning coffee. Would you consider this an OPSEC vulnerability? (Y/N)
Answer: _N_

Task 5 - Risk Assessment
---------------------------------------------

The next step after analysing the vulnerabilties is to conduct a risk assessment.  [NIST](https://csrc.nist.gov/glossary/term/risk_assessment) defines a risk assessment as "The process of identifying risks to organizational operations (including mission, functions, image, reputation), organizational assets, individuals, other organizations, and the Nation, resulting from the operation of an information system." Chance vs. Cost are essentially what we are concerned with. The likelyhood that something could occur, and if it does how much will it cost us.

After determining these risks, we can consider countermeasures to mitigate the risk. We should consider the following:

1. Efficiency of the countermeasure
2. Cost of the countermeasure compared to the impact
3. Possibility that a countermeasure may reveal information to the adversary.

Considering our example from previous task, with a vulnerability of hosting nmap, phishing, and metasploit from a single IP. If we know a client uses a Security Information and Event Management (SIEM) in place, we would know that it is very likely and easy to connect the 3 events and so the event would be a high risk. Without such a SIEM, it would be rated a low risk.

Again with the example of using an unsecured database to store data from our phishing page, based on data from research groups using honeypots, we can expect that bots will randomly target our IP eventually and it would be discovered, as a matter of time and course.

__Questions__

  
Your red team uses THC-Hydra to find the password for a specific login page. Moreover, they are using the Metasploit framework on the same system as THC-Hydra. Knowing that your target uses a properly configured Intrusion Detection System (IDS), would you consider this vulnerability as high risk? (Y/N)
Answer: _Y_


Task 6 - Countermeasures
--------------------------------------------

The final step is applying countermeasures.  The US Department of Defense (DoD) [Operations Security (OPSEC) Program Manual](https://www.esd.whs.mil/Portals/54/Documents/DD/issuances/dodm/520502m.pdf) states, _“Countermeasures are designed to prevent an adversary from detecting critical information, provide an alternative interpretation of critical information or indicators (deception), or deny the adversary’s collection system.”_

If we review our examples from before, in the case of Namp scans running from the same IP as  our Metasploit Framework is running from, and hosting phishing pages from the same IP, the countermeasure is obvious. We should split the services and use different IP addresses for each activity. This way if one of them was detected, the other 2 can continue operations.

In the example of the open database for the phishing campaign, an effective countermeasure could be to secure the database so that it can only be accessed by an authorized party.

__Questions__

This concludes the fifth element in the OPSEC process. Let’s get ready before we apply all five elements to other instances of critical information.
Answer: _None Needed_

Task 7 - More Practical Examples
------------------------------------------------------

In this task, we apply the five elements of the OPSEC process as we focus on different examples of critical information related to red team tasks. We will follow the following steps:

1.  Identify critical information
2.  Analyse threats
3.  Analyse vulnerabilities
4.  Assess risk
5.  Apply appropriate countermeasures

Programs/OS/VM used by the red team

* Critical Information: Programs, OS and VMs
* Threat Analysis: The Blue Team are looking for things that stand out or abnormalities. Are our hostnames and OS versions etc a match for production?
* Vulnerability Analysis: If the OS chosen is too unique, it would be easy to spot. The same with hostnames, Browser user agents, etc.
* Risk Assessment: This mainly depends on the services we are connecting to. For example, connecting to a VPN server will log a lot of info about us. Other services may log more or less.
* Countermeasures: We should consider ways to camoflauge things like OS/VM name/etc Try to match your target parameters as closely as possible.

Example: The following shows the HTTP user-agent when running an nmap scan. If you use the `-sC` option it would probe the webserver. If you don't set the user agent ahead of time then the web server could like the default `Nmap Scripting Engine`.  This can be remedied using the option `--script-args http.useragent="CUSTOM_AGENT"` 

![[redteam3.png]]

__Questions__

Click on View Site and follow through till you get the flag.

(Please note that some browser extensions, such as NoScript, might prevent the site from loading correctly.)

There are 4 sets of questions. The 1st 2 are given in the correct order. You have to read the questions to answer all 5 in order to proceed to the next set of quetions.

The Answers are:
* 4 5 2 3 1
* 1 5 4 3 2
* 5 2 4 3 1
* 2 3 1 5 4

Once you answer all the questions correctly you should get the flag:
Answer: _THM{OPSEC-RED-TEAM}_

Task 8 - Summary
----------------------------------

In this room, we have covered how the OPSEC process can be applied to red team operations. OPSEC process has five elements:

1.  Identify critical information: “Critical information includes, but is not limited to, red team’s intentions, capabilities, activities and limitations.”
2.  Analyse threats: Threat analysis refers to identifying potential adversaries and their intentions and capabilities.
3.  Analyse vulnerabilities: An OPSEC vulnerability exists when an adversary can obtain critical information, analyse the findings, and act in a way that would affect your plans.
4.  Assess risks: “Risk assessment requires learning the possibility of an event taking place along with the expected cost of that event.”
5.  Apply appropriate countermeasures: Countermeasures are designed to prevent an adversary from detecting critical information, provide an alternative interpretation of critical information or indicators (deception), or deny the adversary’s collection system.

OPSEC is a process that can be applied outside the military. This room covered how it is applied to red team operations; furthermore, it is not difficult to apply it to other fields, such as marketing or industry. This process will help prevent the adversary from putting the pieces together, thus preventing them from taking timely action.

__Questions__

Memorise the five elements of the OPSEC process and learn how to apply them to the different aspects of your cybersecurity work.
Answer: _None Needed_




