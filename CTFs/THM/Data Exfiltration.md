
<span class="highlight" style="color: red; background-color: #170202">An introduction to Data Exfiltration and Tunneling over various protocols.</span>

Task 1 - Introduction
----------------------------------

### Welcome to Data Exfiltration

Cybercriminals often use unique techniques to get the data from servers they hack without anyone noticing.  Of course companies employee many methods to protect data, but there are very sneaky ways to get data off of a server over standard protocols like DNS, HTTP(s)/ SSH/ etc. so that it looks like standard traffic.  This makes it extremelt difficult to determine how it is happening.

### Learning Objectives

We will learn about some of the data exfilration types and showcase some techniques about this:

-   What is Data exfiltration?
-   Understand data exfiltration types and how they can be used.  
-   Practice data exfiltration over protocols: Sockets, SSH, ICMP, HTTP(s), and DNS.
-   Practice C2 communications over various protocols.
-   Practice establishing Tunneling over DNS and HTTP.

### Room Prerequisites

-   [Introductory Networking](https://tryhackme.com/room/introtonetworking)  
-   [Protocols and Servers](https://tryhackme.com/room/protocolsandservers)  
-   [DNS in Detail](https://tryhackme.com/room/dnsindetail)
-   [DNS Manipulation](https://tryhackme.com/room/dnsmanipulation)
-   Using tmux or similar tools! (for multiple sessions on single SSH login)

__Questions__
Read the task above!
Answer: _None Needed_


Task 2 - Network Infrastructure
-----------------------------------------------------

### Network Infrastructure

Here we have a practical scenario where we can perform data exfiltration and tunneling using various network protocols. The provided VM in the task contains two separate networks with multiple clients. We also hav a Jumpbox with access to both networks. The following diagram shows the setup:

![[dataexfil-1.png]]

Use the network diagram for your reference during the coming tasks for various protocols. We also set up a domain name, thm.com, to make it easier to communicate and connect within the network environment. Check the following table for more information about the domain names and network access used in this room.

| Domain Name      | IP Address    | Network Access  |
| ---------------- | ------------- | --------------- |
| jump.thm.com     | 192.168.0.133 | Net 1 and Net 2 |
| uploader.thm.com | 172.20.0.100  | Net 1           |
| flag.thm.com     | ###.##.#.###  | Net 1           |
| victim2.thm.com  | 172.20.0.101  | Net 1           |
| web.thm.com      | 192.168.0.100 | Net 2           |
| icmp.thm.com     | 192.168.0.121 | Net 2           |
| victim1.thm.com  | 192.168.0.101 | Net 2                |

### Deploy the VM!

Deploy the provided VM and connect to it via an SSH client by deploying the AttackBox or connecting to the VPN. Use the following credentials to connect to the Jumpbox machine with access to the internal networks.

Machine IP: MACHINE_IP            Username: thm         Password: tryhackme 

Connect to the VM via the SSH client

```shell
root@AttackBox$ ssh thm@MACHINE_IP 
```

Once you are connected to the Jumpbox machine, you have access to both networks. Check the network infrastructure for more information.

### Lab Recommendation

-   We recommend using the **JumpBox** and the network environment for most tasks (TCP, SSH, ICMP, DNS) to avoid technical issues with DNS and networking. However, If you prefer to use the AttackBox for the DNS Tunneling task (task 10), you must change the DNS settings of the AttackBox to MACHINE_IP. For more information about changing the DNS for AttackBox, check the DNS configuration (Task 8). 

-   In most cases, we need to use two machines to establish communication. Thus, we need two or more Linux terminals available to complete the task. Therefore, we recommend using the tmux tool for creating multiple sessions over a single SSH login.

__Questions__

Once you've deployed the VM, please wait a few minutes for the VM and the networks to start, then progress to the next task!

Answer: _None Needed_


